%===============================================================================

\chapter{Úvod}

\note{TODO: revize}

Hry pro mobilní zaøízení, zejména telefony a tablety, v~souèasnosti za¾ívají nebývalý rozmach. Dalo by se øíct, ¾e jsou nyní tam, kde byly pøed patnácti a¾ dvaceti lety hry poèítaèové. Zatímco typický tým vyvíjející hru pro poèítaè nebo herní konzoli èítá desítky, ale èasto i stovky èlenù, hru pro mobilní telefon je stále mo¾né stvoøit jen v~nìkolika málo lidech.

Neustále narùstající výkon dovoluje pøiblí¾it se kvalitì poèítaèových her. Tìmi se novì díky mobilním zaøízením mù¾e hráè zabavit napøíklad na cestách anebo pøi èekání na autobus. Velká vìt¹ina lidí s~sebou neustále nosí výkonný poèítaè ve velmi malém balení, který je navíc vybaven mno¾stvím sensorù a èasto i soustavným pøipojením k~internetu. To nabízí prostor pro velké mno¾ství inovací a je dobøe ¾e se takové inovativní pøístupy skuteènì objevují.

Tato práce se pokusí pøispìt svým dílem navr¾ením nové metody ovládání leteckých her pro mobilní zaøízení. Nejdøíve popí¹e platformu na které bude implementace probíhat, dále vysvìtlí principy díky kterým letí a manévruje skuteèné letadlo. Tyto principy poté zjednodu¹í pro pou¾ití v~prostøedí her a shrne souèasné mo¾nosti ovládání herních letadel. Nakonec navrhne novou metodu ovládání zalo¾enou na dotyku a popí¹e souèasný stav její implementace a hry na ní zalo¾ené.





\chapter{Vývoj her na platformì Android}

\note{OK r1}

Andriod je operaèní systém pro mobilní zaøízení, zalo¾ený na Linuxovém jádøe a poskytovaný ve formì otevøeného zdrojového kódu. Poprvé byl pøedstaven v~roce 2007, první mobilní telefon s~Androidem se dostal na trh o~rok pozdìji. Aktuálnì dle statistik za první ètvrtletí roku 2013 má na poli \textit{chytrých mobilních telefonù} (smartphone) Android jako¾to operaèní systém podíl pøes 38\% \cite{statCounter} (mìøeno na základì nav¹tìvovanosti webových stránek z mobilních telefonù) se zøejmým vzestupným trendem. Aèkoliv je Android pou¾itelný pro mno¾ství rùzných zaøízení (a implementace mimo pole mobilních telefonù se u¾ nyní objevují), bude se tato práce soustøeïovat pouze na jeho vyu¾ití v~mobilních zaøízeních typu mobilního telefonu nebo tabletu. Informace v následujících kapitolách budou vycházet z oficiálního vývojáøského portálu \cite{androidDevelopers} a z vlastních zku¹eností a poznatkù. Kapitola \ref{sec:libgdx} pak bude èerpat z dokumentace knihovny Libgdx \cite{libgdx} a také knihy tého¾ autora \cite{ligbdxKniha}.


\section{Architektura systému}

\note{OK r1}

Architekturu systému lze rozdìlit do nìkolika úrovní. Na té nejvy¹¹í jsou aplikace psané v~jazyce Java, které pou¾ívají systémové funkce a rozhraní. Distribuují se v~balíècích v~tzv. \textit{mezikódu} (Java bytecode). Mezikód je výstup kompilace a jako takový je pøenositelný mezi platformami. Pro spu¹tìní v¹ak potøebuje interpret, kterým je v~tomto pøípadì virtuální stroj pojmenovaný Dalvik.

Dalvik samotný se nachází na ni¾¹í úrovni, tedy mezi programy a jejich souèástmi v~nativním kódu psanými v~jazyce C, C++ èi jazyce symbolických instrukcí. Zde mù¾eme najít pøedev¹ím sadu systémových knihoven od kterých je vy¾adován vysoký výkon. Jsou jimi napøíklad knihovny pro vykreslování (OpenGL), databáze (SQLite), ¹ifrování (SSL) anebo multimédia. Jejich rozhraní je dostupné jak v~prostøedí Javy, tak skrze \textit{JNI} (Java Native Interface). JNI je rozhraní umo¾òující psát programy v~nìkterém z~vý¹e uvedených jazykù s~mo¾ností pøímého propojení se souèástmi psanými v~Javì. Aplikace jako celek je pak rozdìlená do dvou samostatnì kompilovaných èástí, jejich¾ spolupráci zaji¹»uje Dalvik.

Do nativního kódu je vhodné pøevést pøedev¹ím provádìní nároèných operací v~kritickém èase, napøíklad simulaci fyziky ve 3D scénì anebo výpoèty pro umìlou inteligenci. Není ov¹em vhodné, aèkoliv by se to mohlo zdát, implementovat zde celou aplikaci. Výkon nemusí být oproti interpretovanému kódu nutnì vy¹¹í, a naopak mohou nastat problémy s~pøenositelností a optimalizací pro konkrétní zaøízení \cite{jniPerf}. Tu by bì¾nì provádìl Dalvik, zde ale zále¾í plnì na programátorovi. Konkrétní pøínosy i slabiny pou¾ití JNI budou dále rozvedeny v kapitole \ref{sec:nativni-vyvoj}.

Na nejni¾¹í úrovni je ji¾ zmínìné jádro psané v~jazyce C. To zaji¹»uje pøístup k~hardwaru, multitasking, správu souborového systému a dal¹í základní úlohy. Pøímo k~jádru v¹ak programátor v~drtivé vìt¹inì pøípadù nepotøebuje pøistupovat. Funkce jádra programátor vyu¾ije jen pøi výjimeèných pøípadech kdy vytváøí systémovou aplikaci. Taková aplikace vy¾aduje pro svùj bìh vy¹¹í oprávnìní a bì¾ný u¾ivatel ji nemù¾e spustit. Své uplatnìní ale nachází pøi modifikacích systému, kde jako¾to pøedinstalované aplikace získávají vy¹¹í oprávnìní automaticky. Jeliko¾ je Android otevøená platforma, je mo¾né její souèásti libovolnì upravovat a takto vzniklý systém distribuovat.





\section{Verze systému a cílová zaøízení}

\note{TODO: revize, nové procenta a grafy}

Vývoj operaèního systému vede firma Google, která vydává zdrojové kódy nových verzí. Ty se ov¹em pøímo do zaøízení dostávají jen velmi zøídka (jde o~referenèní modely telefonù a tabletù které si nechává vyrábìt pøímo Google). Typicky pøebírají kód jednotliví výrobci a upravují èi doplòují jej tak, aby fungoval pro konkrétní modely (nekompatibilita hrozí pøedev¹ím u~specifického hardwaru jako je 3D displej). Èasto také výrobce pøidává dodateèné aplikace, a» u¾ pro plné vyu¾ití mo¾ností zaøízení nebo èistì pro reklamní úèely. Jak bude výsledný systém vypadat, jaké funkce bude obsahovat a jaká zaøízení bude podporovat je plnì v~zodpovìdnosti výrobcù. Právì kvùli tomu jsou nejèastìji aktualizovány modely z~vy¹¹í cenové tøídy a levnìj¹í zaøízení bývají opomíjena.

Dùsledkem otevøenosti Androidu je jeho roztøí¹tìnost co se verzí týèe. Aktuální rozlo¾ení verzí \textit{API} (programátorské rozhraní, Application Programming Interface) k~prosinci 2012 je na obrázku \ref{fig:api-verze}, data pocházejí z~oficiálního zdroje \cite{statsDroid}. Je jasnì vidìt dominance verzí 9 a 10 (v~u¾ivatelském znaèení jde o~Android verze 2.3.x) které jsou i nyní, po témìø dvou letech od prvního vydání, stále nasazovány do novì prodávaných zaøízení.

\begin{figure}[ht]
	\begin{center}
		\vspace{\baselineskip}
		\includegraphics{fig/api-versions.pdf}
		\caption{Rozlo¾ení verzí systému Android k~prosinci 2012}
		\label{fig:api-verze}
	\end{center}
\end{figure}

Je èasto pøipomínanou pravdou, ¾e právì zpìtná kompatibilita se star¹ími verzemi systému znamená pro tvùrce aplikací mno¾ství práce navíc. V~pøípadì vývoje her v¹ak toto neplatí, nebo» ve skuteènosti vyu¾ívají jen malou èást API. Zde je z~programové èásti dùle¾itá pøedev¹ím podpora knihovny OpenGL ES ve verzi 2.0. Ta je nyní dostupná na více ne¾ 90\% zaøízení a mù¾eme ji tedy pova¾ovat za standard. Mnohem dùle¾itìj¹í je v¹ak technická vybavenost zaøízení, zejména pak výkon procesoru, výkon grafického èipu a velikost jeho pamìti. Zde jsou parametry èasto velmi rozdílné a relevantní srovnání èi statistiky bohu¾el chybí. Nezanedbatelným parametrem jsou také rozmìry displeje. Vzhledem k~rùzným hustotám zobrazení není vhodné uvádìt pouze rozli¹ení. Vìt¹í vypovídací hodnotu z~hlediska dotykového ovládání má fyzická úhlopøíèka displeje, která je v~souèasnosti nejvíce zastoupená v~rozmìrech okolo 4 palcù. \cite{statsDroid}






\section{Nativní vývoj her}
\label{sec:nativni-vyvoj}

\note{OK r1}

Pokud se zamìøíme konkrétnì na vývoj grafických her, zjistíme ¾e hluboké znalosti systému nejsou nezbytné. Android umo¾òuje navrhovat velmi slo¾itá a propracovaná u¾ivatelská rozhraní, hernímu vývojáøi v¹ak bude staèit jen nezbytné minimum. Podobnì je tomu s~dal¹ími vymo¾enostmi systému.

Základním stavebním kamenem ka¾dé aplikace je tzv. \textit{Aktivita} (tøída \texttt{Activity}). Zjednodu¹enì lze øíct ¾e Aktivita je okno aplikace, typicky zobrazované pøes celý prostor displeje (s~výjimkou informaèní li¹ty a pøípadných virtuálních kláves), se kterým mù¾e u¾ivatel interagovat. Aktivita je rodièem jednotlivých elementù u¾ivatelského rozhraní, pøípadných dialogù, nabídek a dal¹ích prvkù. Pro potøeby hry bì¾nì postaèuje jediná aktivita jejím¾ potomkem je speciální oblast do které mù¾e vykreslovat OpenGL (oblast je tøídy \texttt{GLSurfaceView}). Pøi vytoøení této oblasti systém souèasnì spustí speciální vlákno, které má pøístup k~OpenGL kontextu, a mù¾e tedy provádìt grafická volání. Toto vlákno je poté systémem pravidelnì probouzeno tak, aby vykreslování probíhalo v~rychlosti co nejbli¾¹í ideálním 60 snímkùm za vteøinu. S~u¾ivatelským rozhraním systému bì¾ící hra a¾ na výjimky nepracuje, v¹e probíhá v oblasti vyhrazené pro vykreslování.

Kromì zobrazování je Aktivita dùle¾itá také pro pøíjem vstupních událostí. Má mo¾nost \textit{pøihlásit} se u~systému ke sledování dotykù na obrazovce, stiskù tlaèítek, naklonìní zaøízení, pøípadnì stavù dal¹ích sensorù. Tyto události pøicházejí v~oddìleném vláknì které nemá mo¾nost vykreslování. Vlákno typicky upraví vnitøní stav hry a poté se opìt uspí a èeká na dal¹í událost. Platí zde samozøejmì obdobné principy jako u~jiných vícevláknových prostøedí. Jak vlákno pro vykreslování, tak i vlákno pro zpracování události nesmìjí provádìt blokující volání a nemìly by provádìt èasovì nároèné výpoèty. Pro takové pøípady nabízí Android mo¾nost spu¹tìní oddìleného vlákna a postupy jak s~takovým vláknem asynchronnì komunikovat, ani¾ by docházelo k~naru¹ení plynulosti bìhu aplikace, v~tomto pøípadì poklesu poètu vykreslených snímkù za vteøinu.




\subsection{Negativa nativního vývoje}
\label{sec:negativna-nativniho-vyvoje} 

V~pøípadì ¾e zvolíme tvorbu hry èistì na základì Androidu bez mezièlánkù typu frameworku nebo herního engine, mù¾eme narazit na nìkteré nepøíjemnosti. Pøedev¹ím nemù¾eme poèítat s~jakýmkoliv roz¹íøením nad mo¾nosti OpenGL ES. Je plnì v~kompetenci programátora aby si pøipravil potøebné datové struktury a pomocné tøídy. Systém jako takový sice obsahuje nìkolik základních tøíd pro popis vektorù a matic a operace s~nimi, ty ale nebyly navr¾eny pro práci s~OpenGL a dochází zde k~nesrovnalostem (pøíkladem mù¾e být vnitøní reprezentace matice, která je jednou øádková a jindy sloupcová).

Jako jedna z~výhod aplikací v~jazyce Java bývá uvádìna automatická správa pamìti pou¾itím tzv. \textit{garbage collectoru}, tedy souèásti virtuálního stroje, která poèítá reference na ka¾dý alokovaný objekt a v~pøípadì odstranìní posledního výskytu tento objekt uvolní z~pamìti. Aèkoliv mù¾e být tento pøístup pohodlný, pøiná¹í mno¾ství rizik. Vzhledem ke slo¾itosti operaèního systému (a èasto i neznalostí jazyka Java) je pro programátora relativnì snadné dr¾et referenci na objekt, který ji¾ nepou¾ívá a o~kterém pøedpokládá, ¾e ji¾ byl z~pamìti uvolnìn. Tím sice nedochází k~nenávratnì ztraceným blokùm pamìti jako pøi práci v~nativním kódu, pamì»ové nároky aplikace v¹ak zbyteènì rostou. Èím více pamìti pak aplikace pou¾ívá, tím èastìji se bude garbage collector obracet právì na ni a její pamì» se bude sna¾it uvolòovat. A~právì pøi úklidu pamìti dochází ke krátkému pozastavení v¹ech vláken dané aplikace. Toto pozastavení bì¾nì trvá jednotky a¾ desítky milisekund a nemusí být pro u¾ivatele viditelné. Zda se ale aplikace pozastaví a jak dlouho tento stav potrvá závisí na velkém mno¾ství faktorù které programátor nemá pod kontrolou. Je tedy velmi dùle¾ité zvolit vhodnou taktiku práce s~pamìtí a té se striktnì dr¾et. Jednou z~mo¾ností je pøedbì¾né vytvoøení v¹ech objektù které mohou být potøeba s~tím, ¾e v~prùbìhu hry ji¾ nové objekty nevznikají. Toto je v¹ak ideální stav, kterého není snadné dosáhnout. Sofistikovanìj¹í správa pamìti bude popsána v~kapitole \ref{sec:libgdx}.

S~problematikou pamìti souvisí také naèítání dat potøebných ve høe, zejména pak geometrie scény a textur. V~pøípadì 3D modelù opìt narazíme na neexistenci jakýchkoliv pomocných tøíd. Ve vývojáøské komunitì navíc není úplná shoda na tom, který z~formátù ulo¾ení modelù pou¾ívat. Ve výsledku je opìt na programátorovi, aby zvolil vhodný formát, ten nastudoval a implementoval jeho naèítání. To vzhledem ke správì pamìti popsané v~pøedchozí èásti rozhodnì není triviální úkol. (U~mnohých formátù existují více èi ménì zdaøilé implementace jejich naèítání, témìø v¾dy ale diktují v~jakých strukturách budou naètená data ulo¾ena, co¾ nemusí být optimální.) 

V~pøípadì textur je situace o~nìco jednodu¹¹í. Jeliko¾ Android bì¾nì vyu¾ívá rastrová data obvyklých formátù ve svém u¾ivatelském rozhraní, umí takové soubory pøirozenì i naèítat. Nedostatkem zde mohou být zvý¹ené pamì»ové nároky ve chvíli kdy se textura dekóduje ze svého formátu do interní reprezentace (velmi podobné bitmapì) a následnì pøesouvá do grafické pamìti. V~tento okam¾ik jsou souèasnì alokovány dva a¾ tøi objekty reprezentující stejnou texturu, ov¹em s~rozdílnou vnitøní reprezentací. S~velkou pravdìpodobností bude opakovanì docházet ke spu¹tìní automatického úklidu pamìti. V~krajních pøípadech pøi pou¾ití rozmìrných textur mù¾e dojít i k~ukonèení aplikace z~dùvodu pøekroèení maximálního mno¾ství pøidìlené pamìti.

Zmínìné slabiny nízkoúrovòového pøístupu k~tvorbì her jsou jen jedny z~mnoha. Zcela jistì zále¾í na subjektivním pøístupu a zku¹enostech, zda se mù¾ou rozvinout do skuteèných problémù èi nikoliv. Drtivá vìt¹ina tìchto i jiných nedostatkù je samozøejmì øe¹itelná a vývojová prostøedí nabízejí mno¾ství pomocných nástrojù. V extrémním pøípadì mù¾e programátor zajít a¾ tak daleko, ¾e vytvoøí vlastní framework èi engine. Je v¹ak otázkou, zda by mìl své síly soustøedit na ladìní a obcházení záludností systému nebo pou¾ít existující øe¹ení a své síly zamìøit na konkrétní prvky, které odli¹í jeho hru od konkurence.

\vspace{\baselineskip}

Z vý¹e uvedeného je zøejmé, ¾e u~vìt¹iny grafických aplikací je ¾ádoucí pou¾ít existující a ovìøený kód na kterém se bude dále stavìt. Není podstatné zda pùjde o~malou knihovnu, framework èi herní engine -- názvosloví zde není ustálené (v~dal¹ím textu se proto budu dr¾et obecného pojmu \textit{knihovna}). Dùle¾itý je pøínos pro programátora, úspora èasu a prostøedkù, mo¾nost soustøedit se na konkrétní produkt a ignorovat podru¾né problémy. V~neposlední øadì také pou¾ití knihovny znamená pøenesení odpovìdnosti za èást aplikace na nìkoho jiného. To mù¾e znamenat zefektivnìní vývojového procesu, ale také jeho zásadní zpomalení v~pøípadì ¾e se vývoj knihovny zastaví nebo obsahuje chyby které autor nechce èi nemù¾e opravit.



\section{Komplexní vývojová prostøedí}

Jistou ochranou pøed hrozbou budoucích problémù je vyu¾ití komerènì nabízených øe¹ení. Dva nejroz¹íøenìj¹í zástupci této kategorie jsou Unity 3D a Unreal Engine, kde oba sami sebe oznaèují za herní engine. V~obou pøípadech jde o~specializovaná vývojová prostøedí která se sna¾í upozadit programování ve smyslu psaní kódu a naopak upøednostòují pøímé sestavování scény a definice chování. Vývojáø mù¾e hru hrát a soubì¾nì v~reálném èase upravovat. K~tomu slou¾í interaktivní pohled do scény, kde je mo¾né pracovat na úrovni objektù. Samozøejmostí je mno¾ství pøeddefinovaných chování, fyzikálních vlastností, materiálù a èasto i celých objektù se v¹emi vlastnostmi (napøíklad celé pojízdné auto). Na skuteèné programování pøichází èas pouze ve chvíli, kdy je potøeba nadefinovat vnitøní logiku hry, pøípadnì vytvoøit nové chování nìkterého z~objektù. V~takovém pøípadì pou¾ívá engine vlastní skriptovací jazyk. Jak Unity 3D, tak i Unreal Engine jsou komplexní vývojová prostøedí produkující multiplatformní aplikace a Android je pouze jedním z~mnoha výstupù. Vývojáø ve skuteènosti pøichází s~architekturou Androidu do kontaktu jen minimálnì nebo vùbec. I~pøesto není vhodné tento pøístup opomíjet, nebo» s~pou¾itím právì Unity 3D vznikají v~souèasnosti nejlépe hodnocené a po vizuální stránce nejpropracovanìj¹í hry. Záporem je zde vysoká poèáteèní investice, a to v~øádu minimálnì stovek dolarù.

\note{Obrázek vývojového prostøedí UDK / Unity ?}

\begin{figure}[ht]
	\begin{center}
		\vspace{\baselineskip}
		\includegraphics[width=\textwidth]{fig/shadowgun.jpg}
		\caption{Hra Shadowgun od brnìnského studia Madfinger Games, vytvoøená v~Unity 3D}
		\label{fig:shadowgun}
	\end{center}
\end{figure}



\section{Knihovna Libgdx}
\label{sec:libgdx}


\note{TODO: zmínit i bullet - vlastní kapitola?}

Alternativou k~placeným vývojovým nástrojùm jsou men¹í knihovny s~tìsnìj¹í vazbou na systém Android. Nejpou¾ívanìj¹í z~nich jsou AndEngine a Libgdx. První z~jmenovaných se nazývá herním engine, druhý se oznaèuje za framework. Oba jsou v¹ak k~dispozici zdarma ve formì otevøených zdrojových kódù s mo¾ností komerèního i nekomerèního vyu¾ití. Jeliko¾ jsou si obì knihovny velmi podobné, soustøedím se v~dal¹ím popisu pouze na Libgdx, kterou také pou¾iji pøi implementaci. Zdrojem bude z~velké èásti oficiální dokumentace \cite{libgdx} a také kniha ?? ???? ? \cite{mario}. Jejím autorem je Mario Zechner, který je souèasnì tvùrcem knihovny Libgdx a jejím hlavním pøispìvatelem.

\note{TODO: Citovat Mariovu knihu!}
\note{TODO: Øíct ¾e kapitola èerpá z dokumentace libgdx a scene2d.ui}

Na první pohled vypadá knihovna Libgdx podobnì jako døíve zmínìné nástroje -- stejnì jako ony je schopná produkovat aplikaèní balíèky pro více platforem. Pùvodnì v¹ak vznikala jako knihovna pro tvorbu 2D her pro Androida a a¾ postupem èasu do¹lo roz¹íøení o podporu dal¹ích platforem. Aktuálnì je kromì systému Android podporovaná i tvorba webových appletù a klasických aplikací pro poèítaèe. Jak konkrétnì multiplatformní vývoj probíhá bude popsáno v kapitole \ref{sec:oddeleni-platforem}.

Narozdíl od jiných øe¹ení knihovna neobsahuje ¾ádné vývojové prostøedí ani pøedpøipravená data. Zamìøuje se více na usnadnìní vývoje nabízením pomocných algoritmù a tøíd. Je pak èistì na programátorovi, zda výhod knihovny vyu¾ije. Díky tomu má prostor pro detailní optimalizace na nízké úrovni pro dosa¾ení maximálního výkonu hry, stejnì jako se mù¾e pohybovat na vy¹¹í úrovni, která umo¾ní velmi rychlé prototypování a vytvoøení funkèní aplikace. Mezi pøednosti Libgdx patøí vysoko- i nízkoúrovòové rozhraní pro 2D a 3D grafiku, podpora fyziky, propracovaný systém u¾ivatelského rozhraní, naèítání mno¾ství formátù, práce se zvuky a mnoho dal¹ích. V~neposlední øadì se pak sna¾í stírat rozdíly mezi jednotlivými zaøízeními a verzemi systému Android.

Samozøejmostí je øe¹ení vý¹e zmiòovaných nedostatkù pøi vývoji bez pomocných knihoven. Velká síla Libgdx spoèívá v~tom, ¾e je implementována èásteènì pøímo v~Javì a èásteènì v~nativním kódu. Tím dosahuje vy¹¹ího výkonu zejména u ji¾ zmiòovaných fyzikálních simulací, ale pøedev¹ím má plnou kontrolu nad alokací pamìti a jejím následným uvolòováním. Automatické uvolnìní pøirozenì probíhá pouze v~èásti aplikace be¾ící ve virtuálním stroji, zatímco v~nativním kódu je práce s~pamìtí plnì v~re¾ii programátora. Vhodným propojením tìchto dvou èástí lze bezpeènì alokovat pamì» kterou garbage collector \textit{neuvidí}, a dokonce dosáhnout stavu kdy framework jako takový uvnitø hlavní herní smyèky ¾ádnou pamì» nealokuje. To samozøejmì nemù¾e úplnì zamezit spou¹tìní úklidu pamìti, pøíèinou v¹ak bude bìh ostatních aplikací a systému, nikoliv samotné hry. V~praxi se pak pamì» uklízí jen velmi výjimeènì, probíhá velmi rychle (garbage collector spravuje jen velmi malé mno¾ství pamìti), a hra tedy mù¾e bì¾et plynule.

\subsection{Struktura aplikace}
\note{r1 OK}

Vstupním bodem aplikace je instance tøídy \texttt{Application}, která obsahuje základní herní smyèku. Ta je volaná systémem právì na døíve zmiòované frekvenci blízké 60 snímkùm za sekundu. Pøi tvorbì grafických aplikací se èasto vyu¾ívá oddìlené volání pro aktualizaci scény a její vykreslení, Android v¹ak takové rozdìlení nepodporuje (z dùvodu návaznosti na systémový element s OpenGL kontextem, popsaný v kapitole \ref{sec:nativni-vyvoj}. Je samozøejmì mo¾né aktualizaci scény a její vykreslení oddìlit ruènì, napøíklad v pøípadì ¾e není nutné se scénou manipulovat pøíli¹ èasto, ale chceme zachovat plynulost vykreslování. Typické vyu¾ití mù¾e být u tahových her, kdy se herní logika provádí jen v okam¾iku tahu, zatímco zobrazování probíhá v ka¾dém snímku, napøíklad kvùli probíhajícím animacím. Je samozøejmì mo¾né optimalizovat je¹tì více, animace nepou¾ívat a vykreslovat jen ve chvíli, kdy se scéna zmìní. V takovém pøípadì dochází k maximální úspoøe energie. Aplikace ale mù¾e pùsobit znaènì statickým dojmem a pro akèní hry tento pøístup není vhodný vùbec.

Zatímco samostatná tøída aplikace je vhodná jen pro nejtriviálnìj¹í aplikace, u slo¾itìj¹ích bude ¾ádoucí rozdìlit aplikaci do nìkolika èástí. Zde knihovna nabízí èlenìní do tzv. \textit{obrazovek} (potomci tøídy \texttt{Screen}), které mají vlastní ¾ivotní cyklus. Hlavní tøída aplikace pak obstarává pouze pøepínání mezi jednotlivými obrazovkami. Ty lze pova¾ovat za oddìlené logické celky a èasto je mo¾né je i samostatnì vyvíjet, co¾ bude pøínosem zejména pro víceèlenný tým vývojáøù. Obrazovka jako taková v¹ak ¾ádné vy¹¹í funkce nemá a kromì zmínìného zpøehlednìní kódu nabízí jen mo¾nost jednoduchého vykreslování texturovaných obdélníkù (tzv. \textit{sprite}).


\subsection{Zpracování vstupních událostí}
\label{sec:libgdx-vstup}
\note{r1 OK}

Vstupní události jsou závislé na aktuální platformì, a proto jsou v Libgdx skryty pod jednotným rozhraním, kdy konkrétní implementaci doplòuje sama knihovna právì podle aktuálního prostøedí. Programátor díky tomu nemusí øe¹it, zda bude aplikace ovládaná dotykem èi my¹í, klávesnicí nebo hardwarovými tlaèítky mobilního telefonu nebo tøeba ovladaèem typickým pro herní konzole. Je zøejmé, ¾e v¹echny typy událostí nebudou podporovány na v¹ech platformách. Knihovna v¹ak zavádí vhodné substituce a sjednocení, kde napøíklad kliknutí na dotykovém displeji odpovídá kliknutí levého tlaèítka my¹i. Na vy¹¹í úrovni je pak mo¾né detekovat celá gesta jako chycení a táhnutí nebo zoom.

Pøirozenì lze definovat i vlastní zpracování vstupu. Pøíkladem mù¾e být køí¾ový ovladaè vykreslovaný na obrazovku v pøípadì, ¾e aplikace bì¾í na dotykovém zaøízení. Vnitønì pak mù¾e takový ovladaè \textit{pøekládat} dotykové události na události stisku klávesy. Ty pak aplikace obslou¾í jako bì¾né události a programátor tak velmi snadno získává podporu pro dotyková zaøízení, poèítaèové klávesnice i konzolové ovladaèe.

Toto chování je umo¾nìno tzv. \textit{vstupními procesory} (tøída \texttt{InputProcessor}). Vstupní procesor je tøída obsahující kód pro zpracování vstupních událostí. V okam¾iku zpracování v procesoru u¾ je známo o jaký typ události jde. Procesor jako takový tedy ¾ádnou detekci neprovádí. Typicky obsahuje referenci na objekty aplikaèní logiky a s tìmi nìjak pracuje. Na konci svého bìhu vrací návratovou hodnotu podle toho, zda událost zpracoval (a mìla by tedy zaniknout) anebo ne (co¾ nutnì neznamená ¾e na událost nijak nereagoval).

Vstupních procesorù mù¾e být v aplikaci nìkolik, aktivní je ale v¾dy pouze jeden. Pro komplexní zpracování vstupù se proto zavádí tzv. \textit{multiplexer} (tøída \texttt{InputMultiplexer}), který pøedstavuje kontejner vstupních procesorù, pøièem¾ rozhraní procesoru také sám implementuje. Pøi pøíchodu události ji pouze pøedává jednotlivým procesorùm do té doby, dokud ji nìkterý z nich nezpracuje. 

Tím je mo¾né vytváøet kaskády vstupních procesorù a» u¾ pro zmínìné sjednocení vstupù napøíè platformami anebo pro obsluhu událostí ze slo¾itìj¹ích scén. Pøíkladem mù¾e být dotykem ovládaná hra vyu¾ívající doplòkové ovládací prvky na obrazovce. Vhodným øe¹ením by mohl být multiplexer zastøe¹ující vstupní procesor pro doplòkové prvky (pøicházející na øadu jako první, tedy mù¾e událost zpracovat a nepustit dál) a procesor pro ovládání samotné hry. Takto oddìlené zpracování vede nejen k pøehlednìj¹ímu kódu, ale i k jednodu¹¹í obsluze událostí ve chvílích, kdy existuje více prvkù soubì¾nì èi postupnì reagujících na stejný vsutp.





\subsection{Tvorba u¾ivatelského rozhraní}
\label{sec:libgdx-ui}

Velmi silnou souèástí Libgdx z hlediska tvorby u¾ivatelského rozhraní je knihovna Scene2D.ui (\note{TODO: citace}), která je pou¾itelná i samostatnì v obecných projektech v jazyce Java. Jejím základním prvkem je tabulka (tøída \texttt{Table}), pro kterou se definují jednotlivé buòky a jejich rozdìlení do øádkù. Chování je podobné tabulkám vytvoøeným v jazyce HTML v kombinaci s CSS. Buòkám lze nastavovat pevné èi pomìrné rozmìry, vnitøní okraje, pozadí a nìkteré dal¹í atributy. Je také mo¾né buòky v rámci jednoho øádku sluèovat; vertikální sluèování podporované není, ale lze jej dosáhnout jinou cestou. Specifickým parametrem bunìk je pak \textit{rozpínavost} v rámci øádku a v rámci sloupce. Vhodnou kombinací je mo¾né vytvoøit dynamickou, tzv. \textit{fluidní} tabulku, která se bude pøizpùsobovat svému obsahu i rozmìrùm zobrazovací plochy.

Nad tabulkami jsou dále vystavìny základní prvky u¾ivatelského rozhraní jako tlaèítka, dialogy, pole pro zadání textu, obrázky, bloky textu, posouvatelné panely a dal¹í. Vyu¾ití tabulky lze demonstrovat na tlaèítku. To je ve skuteènosti tabulka o tøech øádcích a tøech sloupcích, kde prostøední buòka obsahuje textový popisek èí obrázek. V¹echny jeho buòky pak mají vhodnì nastavené pozadí, èím¾ lze vytvoøit napøíklad i tlaèítka se zakulacenými okraji. Samozøejmì si opìt zachovává schopnost pøizpùsobit rozmìry svému obsahu i okolí. Slo¾itìj¹í prvky vznikají obdobnì, pøièem¾ èasto vyu¾ijí i mo¾nost tabulky do sebe libovolnì vnoøovat.

Prvky rozhraní také nemusejí být nutnì statické. Ka¾dý prvek mù¾e mít nadefinováno své vlastní chování a v rámci scény se chovat zcela autonomnì. Souèasnì knihovna nabízí mno¾ství pøeddefinovaných efektù, které lze prvkùm pøiøazovat. Typicky jde o geometrické transformace nebo práce s barvami èi prùhledností. Efekty dostávají jako parametr dobu trvání a krajní hodnoty, mezi kterými v èase interpolují. Podobnì jako pøi zpracování událostí i zde existují speciální efekty chovající se jako kontejnery efektù bì¾ných. Ty umo¾òují nechat efekty probíhat souèasnì anebo v øadì za sebou. Samozøejmostí je opìt libovolné vnoøování, èím¾ lze vytvoøit velmi komplexní chování.

\vspace{\baselineskip}

Koøenovou komponentou u¾ivatelského rozhraní je tzv. \textit{Stage} (jeliko¾ by èeský výraz mohl být zavádìjící, ponechávám bez pøekladu a pou¾iji pøímo název tøídy \texttt{Stage}). Pøedstavuje kontejner na vý¹e popsané prvky rozhraní. Ty sice své vykreslování øídí samy, ale pøedpokládají korektnì nastavené parametry vykreslování, pøedev¹ím pohledových transformací. K tomu slou¾í Stage, která udr¾uje kameru s ortogonální projekcí a nìkteré dal¹í struktury slou¾ící k vnitøní optimalizaci vykreslování. Implicitnì Stage pokrývá celou zobrazovací plochu, ale toto chování je mo¾né zmìnit. Stará se také o poøadí vykreslování prvkù rozhraní, èím¾ øídí jak se budou prvky pøekrývat. Na samotnou Stage mù¾eme také, podobnì jako na jednotlivé její prvky, aplikovat nìkteré efekty. Stejnì tak je mo¾né vlo¾it do jedné obrazovky nìkolik instancí Stage a provádìt navigaci mezi nimi, v rámci jediné obrazovky. 

\begin{figure}[ht]
	\begin{center}
		\includegraphics[width=\textwidth]{fig/ui-design.jpg}
		\caption{Souèásti rozhraní hlavního menu}
		\label{fig:ui-design}
	\end{center}
\end{figure}

\note{TODO: scene2d.ui umí dìlat i jednoduché hry}



\subsection{Pomocné nástroje a souèásti knihovny}
\label{sec:libgdx-tools}

Knihovna Libgdx obsahuje nìkolik velmi u¾iteèných nástrojù. Nìkteré z nich jsou pøímo souèástí kódu knihovny a jsou pou¾itelné pøi bìhu aplikace, jiné jsou distribuovány jako samostatné programy vhodné pro pøedpøipravení dat do vhodného formátu. Jejich pou¾ití èi nepou¾ití je v¾dy rozhodnutí programátora a knihovna jako taková pou¾ití ¾ádné z ní¾e popsaných souèástí nevy¾aduje.

\vspace{\baselineskip}

První zajímavý nástroj se jmenuje \textit{Texture Packer}. Slou¾í k vytváøení tzv. \textit{atlasù textur}, co¾ je jediný obrázkový soubor, který v sobì obsahuje vhodnì poskládané jednotlivé textury. Jde obecnì pou¾ívaný pøístup, který znaènì urychluje naèítání textur i jejich vykreslování zejména v pøípadech, kdy aplikace vyu¾ívá mno¾ství malých textur. Z pohledu naèítání se u¹etøí pøístupy do souborového systému, v okam¾iku vykreslování je pak velká textura ulo¾ená v jediné texturovací jednotce. Pokud by se atlas textur nepou¾il bylo by nutné v prùbìhu vykreslování jediného snímku texturovací jednotky nejen pøepínat, ale vzhledem k jejich omezenému poètu i mìnit k nim pøipojené textury. Texture Packer souèasnì s grafickým výstupem ukládá i soubor ve formátu JSON, který knihovna pøi pou¾ití atlasu automaticky naète a podle informací v nìm obsa¾ených vytvoøí pojmenované texturové oblasti (odpovídající dílèím texturám). S tìmi je následnì mo¾né v aplikaci pracovat jako s bì¾nými texturami, zatímco popsané optimalizace probíhají automaticky bez pøièinìní programátora. U¾iteènou vlastností nástroje Texture Packer je také mo¾nost spou¹tìní z pøíkazové øádky, respektive jeho pøímého zapojení do procesu sestavování aplikace. Programátor tedy udr¾uje adresáø s jednotlivými texturami (jeliko¾ je tento zpùsob mnohem výhodnìj¹í pro pøípadné úpravy), z toho se pøi sestavení aplikace vytvoøí atlas, knihovna jej naète a programátor v aplikaci dostává pøísutp opìt k jednotlivým texturám.

\note{obrázek textury z texture packeru? nebo rovnou rozhraní programu?}

\vspace{\baselineskip}

Dal¹ím u¾iteènou souèástí knihovny je podpora bitmapových písem. K pou¾ívání písem a vypisování textù není v Open GL jednotný pøísup. Bitmapová písma se v¹ak jeví jako rozumný kompromis mezi vektorovì definovanými písmy, které je pøed vykreslením potøeba rasterizovat, a bitmapami s pevnì ulo¾enými øetìzci a texty. Bitmapové písmo se skládá z obrázkového souboru, kde jsou jednotlivé znaky a symboly ulo¾eny podobnì jako textury v atlasu textur, a definièního souboru ve formátu ??? \note{FIXME: jmenuje se nìjak???}. Tento soubor v¹ak kromì informací pro rozsekání obrázku na jednotlivé znaky obsahuje informace o tom, jak znaky skládat do slov, o rozestupech mezi nimi, o názvu a charakteristikách písma a dal¹í. K vytvoøení tìchto souborù lze vyu¾ít nìkterý z volnì dostupných nástrojù (bitmapová písma jsou opìt obecnì pou¾ívanou technikou). Knihovna Libgdx tyto soubory naèítá a mù¾e s jejich pou¾itím vykreslovat jednoøádkový èi víceøádkový dynamický text. Taková funkcionalita je velmi výhodná pøi pøekladu aplikace do jiných jazykù. V takovém pøípadì není potøeba udr¾ovat popisky v grafických souborech (èím¾ rapidnì vzrùstá velikost celé aplikace, ale i nároky na její údr¾bu a dal¹í vývoj), ale je mo¾né pou¾ít bì¾ný textový soubor s øetìzci. Pøidání podpory dal¹ího jazyka pak znamená pouhé pøelo¾ení sady øetìzcù, v¹e ostatní probìhne automaticky, vèetnì napøíklad správného zarování popiskù v u¾ivatelském rozhraní, které plyne z chování prvkù rozhraní popisovaných v kapitole \ref{sec:libgdx-ui}.

\vspace{\baselineskip}

Specialitou knihovny Libgdx je pou¾ití vizuálních témat pro celou aplikaci (základem je tøída \texttt{Skin}). Pøi návrhu u¾ivatelského rozhraní zavádí vrstvu abstrakce, kde ka¾dému typu prvku rozhraní pøiøazuje definici vizuálního stylu. Definuje se tedy obecný vzhled tlaèítek, polí, posuvníkù a dal¹ích prvkù. Je také mo¾né zvolit je¹tì jemnìj¹í dìlení v rámci typu, napøíklad zavést nìkolik skupin tlaèítek a jejich vzhled definovat oddìlenì. Pro popis vizuálních témat slou¾í soubor ve formátu JSON obsahující konkrétní názvy tøíd prvkù rozhraní a poté pro ka¾dý z nich sadu atributù jako je barva, pozadí, pou¾ité písmo a dal¹í. Právì zde lze vhodnì vyu¾ít atlasy textur a bitmapová písma popsaná v pøedchozích odstavcích. Po naètení vizuálních stylù do knihovny jsou automaticky aplikovány. Knihovna pozná ¾e je v rozhraní pou¾itý prvek, jeho¾ tøída má pøiøazenou definici, a tuto pou¾ije. Zmìnou definièního souboru lze velmi snadno zmìnit celý vzhled aplikace. Samozøejmì je mo¾né s aplikací dodávat i nìkolik vizuálních témat a výbìr ponechat na u¾ivateli; z hlediska programátora je toto jen úprava jediného øádku, kde se definièní soubor naèítá.

\vspace{\baselineskip}

Poslední popisovanou souèástí knihovny je \textit{Assets Manager}, který je mo¾né volnì pøelo¾it jako \textit{správce obsahu}. Pøesto¾e je jeho pou¾ití volitelné, je velmi silnì doporuèováno. Správce obsahu toti¾ pøedstavuje jednotné místo v rámci aplikace, pøes které se bude pøistupovat k datovým souborùm. Tìmi mù¾ou být textury, zvuky, rùzné definièní soubory, a teoreticky jakýkoliv obsah. Správce dostane seznam datových souborù které jsou vy¾adovány pro bìh aplikace a tyto soubory bude naèítat. Jeho rozhraní je vhodnì navr¾ené tak, aby bylo pou¾itelné pro vytvoøení naèítací obrazovky s mo¾ností zobrazení reálného prùbìhu. Zajímavý je také zpùsob jakým ze souborù vznikají datové objekty. Aplikace definuje soubor a cílovou tøídu, její¾ instanci chce získat. Pro ka¾dou takovou tøídu pak musí existovat speciální naèítací tøída (tzv. \textit{loader}), která umí ze souboru konkrétní objekt vytvoøit. Pro v¹echny základní formáty u¾ knihovna tyto tøídy nabízí, stejnì jako mo¾nost naèítání parametrizovat, které se vyu¾ije napøíklad pro volbu zpùsobu filtrování textur. Spolu s naèítáním také správce hlídá, zda jsou data je¹tì pou¾ívána a mù¾e je prùbì¾nì uvolòovat. 






\section{Distribuce aplikací}

\note{- podepisování}
\note{- obfuskace? licencování? root?}
\note{- free markety}
\note{- vývojáøský úèet u Google}
\note{- Google Play}
\note{- nemo¾nost beta testerù nebo obecnì dìlení do skupin}
\note{- featuring na hlavní stranì / hlavní stranì kategorie}







\chapter{Ovládání skuteèného a herního letadla}

\note{TODO: doplnit skuteèné rovnice? :-O}

\note{TODO: revize}

Tato kapitola popí¹e principy ovládání letadel a leteckých her. Shrne existující metody a pøedstaví novou metodu zamìøenou na ovládání akèních leteckých her v~mobilních zaøízeních. 

Pøed návrhem herního ovládání letadla je vhodné se seznámit s~tím, jak létají skuteèná letadla. Více ne¾ o~konkrétní rovnice zde pùjde o~základní principy díky kterým se letadlo udr¾uje ve vzduchu. Rovnice by toti¾ nebylo mo¾né vyèíslit bez znalosti konkrétních koeficientù, které jsou pro ka¾dou konstrukci odli¹né. I~s~nimi by v¹ak bylo exaktní matematické popsání letícího letadla velmi obtí¾né. Následující kapitoly budou èerpat pøedev¹ím z~\cite{umeniLetat} a \cite{nasa}.


\section{Síly pùsobící za letu}

\note{TODO: revize}

 Vyjdeme nyní z~takzvaného \textit{ustáleného vodorovného letu}. V~tuto chvíli se letadlo pohybuje konstantní rychlostí s~nulovým zrychlením, nestoupá, neklesá a není v~náklonu. Pùsobí na nìj síly vyznaèené na obrázku \ref{fig:letadlo-sily}. Jsou jimi vzlak, gravitaèní tíha, tah a odpor. Pøi ustáleném letu jsou tyto síly v~rovnováze. Ne v¹ak v¹echny navzájem, jak je nìkdy mylnì uvádìno, ale pouze dvojice sil pùsobících proti sobì. Pro ilustraci mù¾eme pou¾ít namísto celého letadla pouze køídlový profil, na kterém jsou velièiny více zøejmé.

\begin{figure}[ht]
	\begin{center}
		\includegraphics[scale=0.25]{fig/airfoil.pdf}
		\caption{Síly pùsobící na letadlo pøi ustáleném vodorovném letu}
		\label{fig:letadlo-sily}
	\end{center}
\end{figure}

Nejdùle¾itìj¹í silou je vztlak. Ten pùsobí kolmo vzhùru od køídla a pøi vodorovném letu vyrovnává tíhu letadla. Dochází k~nìmu díky typickému profilu køídla, kdy na jeho spodní stranì vzniká vy¹¹í tlak vzduchu a souèasnì na horní se tlak vzduchu sni¾uje. Pro zji¹tìní celkového vztlaku køídla je potøeba znát mno¾ství parametrù, jako je hustota prostøedí èi rychlost pohybu køídla. Pøedev¹ím ale zále¾í na koeficientech popisujících tvar køídla, jeho plochu, rozpìtí a tvar jeho profilu. Pokud by nás zajímal celkový vztlak letadla, bylo by samozøejmì nutné zapoèítat dílèí vztlakové síly na celém jeho povrchu.

Dal¹í z~hlavních sil je tah motoru. Ten je tvoøen jednou èi více vrtulemi. Lopatky vrtule svým tvarem ¾enou vzduch za sebe (tedy smìrem na trup a køídla letadla), èím¾ vzniká síla táhnoucí vrtuli, a tím i celé letadlo, dopøedu. Ta¾ná síla opìt závisí na mno¾ství parametrù které popisují stavbu vrtule, poèet lopatek a jejich aerodynamické vlastnosti, a samozøejmì také na rychlosti jakou se vrtule otáèí. S~vy¹¹í rychlostí stoupá tah a souèasnì se zvy¹uje rychlost proudìní vzduchu v~oblasti za vrtulí. Tím se nepøímo zvy¹uje vztlak køídel, ale také se mìní citlivost ovládacích prvkù letadla.

Gravitaèní síla pùsobící na letadlo je zøejmá a v¾dy smìøuje ke støedu Zemì. 

Poslední silou je odpor který klade vzduch letícímu letadlu a pùsobí v¾dy v~opaèném smìru ne¾ je smìr jeho pohybu. Je slo¾ený ze dvou hlavních slo¾ek. Jednou je odpor zpùsobený tvarem køídla, pota¾mo celého letadla, a jeho pohybem v~prostøedí. Druhou slo¾kou je odpor vznikající na koncích køídel. Jak ji¾ bylo zmínìno, u~horní èásti køídla se nachází podtlak, zatímco u~spodní èásti je naopak pøetlak. V~místì kde je køídlo spojeno s~trupem letadla se tyto tlaky \textit{nepotkávají}, na opaèném konci køídla v¹ak ano. Dochází k~jejich pøirozenému vyrovnávání a vznikají víry, které pokrucují proudìní vzduchu a mìní smìr vztlakové síly køídla. Její pomyslný vektor pak není kolmý ke køídlu, ale mírnì sklopený, èím¾ pøispívá k~velikosti odporové síly. Èím vy¹¹í vztlak køídlo tvoøí, tím více odporové síly souèasnì vzniká. Obecnì je pro zji¹tìní odporové síly dùle¾itá rychlost pohybu a charakteristika prostøedí, pøedev¹ím pak samotný tvar køídel a celého letadla.

Výsledné chování letadla zále¾í v¾dy na pomìru zmínìných sil. Pokud by køídla netvoøila dostateèný vztlak (z~dùvodu konstrukce nebo nízké rychlosti pohybu), letadlo se nevznese, pøípadnì spadne. Je v¹ak nutné si uvìdomit, ¾e s~výjimkou tahu motoru nemá pilot letadla mo¾nost ¾ádné z~uvedených parametrù zmìnit, nebo» jsou dány konstrukcí letadla.



\section{Ovládací prvky a manévry}
\label{sec:let-skutecneho-letadla}

\note{TODO: revize}

Pro popis jiného ne¾ vodorovného letu je potøeba zavést nový pojem, a sice \textit{úhel nábìhu}. Jde o~úhel, který svírá tìtiva profilu køídla s~proudem vzduchu, který na ni dopadá. Úhel nábìhu je vyznaèený na obrázku \ref{fig:uhel-nabehu}.

\begin{figure}[ht]
	\begin{center}
		\includegraphics[scale=0.4]{fig/angle-of-attack.pdf}
		\caption{Úhel nábìhu køídla}
		\label{fig:uhel-nabehu}
	\end{center}
\end{figure}


Navzdory èasté pøedstavì ve skuteènosti neplatí, ¾e by smìr letu letadla byl v¾dy toto¾ný s~osou jdoucí jeho trupem. Pøi dostateèné rychlosti mù¾e letadlo letìt vodorovným letem, pøièem¾ trup bude skuteènì soubì¾ný s~dráhou letu. Vztlak køídla bude v~tomto pøípadì dostateèný právì díky vysoké rychlosti proudìní. Pokud je ale cílem ni¾¹í letová rychlost (napøíklad z~dùvodu úspory paliva), bude pro zachování vodrovného smìru nutné aby pilot zvý¹il úhel nábìhu køídel (pou¾ije k~tomu vý¹kové kormidlo -- viz dále). Tím zvý¹í i jejich koeficient vztlaku a zamezí klesání letadla. V~této chvíli se letadlo pohybuje vodorovnì, ale jeho pøíï je vý¹ ne¾ záï a míøí tedy mírnì nahoru (úhel o~který je letadlo naklonìno odpovídá úhlu nábìhu). Pøibli¾ný vztah mezi úhlem nábìhu a vztlakovým koeficientem køídla je znázornìn na obrázku \ref{fig:vztlak}. Pøesný tvar prùbìhu je opìt dán konstrukèními vlastnostmi konkrétního køídla.

\begin{figure}[ht]
	\begin{center}
		\includegraphics[scale=0.5]{fig/lift-coefficient.pdf}
		\caption{Závislosti vztlakového koeficientu na úhlu nábìhu u~neidentifikovaného køídla. Zdroj: Wikimedia Commons na základì dat z~proframu XFOIL}
		\label{fig:vztlak}
	\end{center}
\end{figure}

Nejvy¹¹í hodnota vztlakového koeficientu je vidìt v~oblasti kolem $17^{\circ}$ (opìt je nutné pøipomenout ¾e tento prùbìh je jen jedním z~mnoha mo¾ných a napøíklad sportovní letadla mohou efektivnì vyu¾ívat i vy¹¹ích úhlù nábìhu). Pøi dal¹ím zvy¹ování úhlu nábìhu se mìní proudìní kolem horní èásti køídla z~\textit{laminárního} (proudnice jsou rovnobì¾né a na pohled vypadají jako by byly rozdìlné do vrstev) na proudìní \textit{turbulentní} (proudnice se trhají a vzájemnì prolínají, vznikají vzdu¹né víry). V~dùsledku vznikajících turbulencí klesá vztlak køídla a souèasnì roste jeho povrchové tøení, èím¾ stoupá i jeho odpor. Na hranici blízké $25^{\circ}$ pak køídlo ztrácí vztlak úplnì a letadlo se zaène propadat. Této situaci se èasto øíká \textit{pøeta¾ení}.

\vspace{\baselineskip}

Pilot k~øízení letadla pou¾ívá takzvané \textit{primární ovládací prvky}. Jsou jimi klapky na køídlech a vý¹kové kormidlo, obojí ovládané kniplem, a dále smìrové kormidlo ovládané pomocí pedálù. V¹echny tyto ovládací prvky ve skuteènosti plní jedinou èinnost, a sice ¾e mìní úhly nábìhu jednotlivých èástí letadla. Pøesto¾e jsou køídla pevnì spojená s~trupem, jsou na nich pohyblivé klapky. Stejnì tak vodorovné vý¹kové i svislé smìrové kormidlo má tvar køídla, jeho¾ èást u~odtokové hrany je pohyblivá.

Pokud nyní pøestaneme dosud popisované síly vztahovat k~celému letadlu, ale budeme je uva¾ovat jako samostatné síly vznikající v¾dy na konkrétním køídle (za køídla zde pova¾ujeme i vý¹kové a smìrové kormidlo), mù¾eme snadno popsat základní letecké manévry.

Proces stoupání èi klesání pilot reguluje nastavením klapek vý¹kového kormidla. V~pøípadì stoupání klapky zvedne, èím¾ sní¾í úhel nábìhu kormidla a tím i jeho vztlak. Záï letadla zaène klesat, úhel nábìhu hlavních køídel letadla se zaène zvy¹ovat a s~ním i jejich vztlak, pota¾mo vztlak letadla jako celku. Pøi klesání je situace analogická, pouze se velièiny pohybují opaèným smìrem.

U~zatáèecího manévru èasto panuje pøesvìdèení, ¾e k~jeho provedení slou¾í smìrové kormidlo, od kterého se u¾ podle názvu oèekává ¾e bude øídit smìr letu. Z~pøedchozích odstavcù ji¾ mù¾eme tu¹it ¾e tomu tak není. Pokud by pilot pøi vodorovném letu pou¾il smìrové kormidlo, záï letadla by se sice vùèi smìru letu natoèila, samotný smìr letu by se v¹ak zmìnil jen málo. Tím jak se osa letadla natáèí vùèi smìru letu souèasnì roste proudìní kolem køídla které je více vystaveno pøímému smìru letu. Tím na køídle vzniká vìt¹í vztlak a letadlo zaèíná podélnì rotovat, aèkoliv je knipl stále ve výchozí poloze.

Správný prùlet zatáèkou probíhá v~náklonu. Pilot nejdøíve zatoèením kniplu nakloní klapky na køídlech (které se narozdíl od vý¹kového a smìrového kormidla pohybují navzájem protichùdnì) tak, ¾e na jednom z~køídel se vztlak zvý¹í, zatímco na druhém se sní¾í. Letadlo tedy letí v~náklonu a vztlak vznikající na køídlech nepùsobí kolmo vzhùru, ale kolmo k~horním stranám køídel (vztlak vzniká stále stejnì, pouze jeho smìr ji¾ není pøímo opaèný ke gravitaèní síle). Mù¾eme tedy vztlakovou sílu pomyslnì rozlo¾it na skuteèný vztlak dr¾ící letadlo ve vzduchu a slo¾ku vodorovnou, která pùsobí jako dostøedivá síla a nutí letadlo skuteènì zatáèet. Smìrové kormidlo pøi prùletu zatáèkou slou¾í regulaci vzájemné polohy pøídì a zádi letadla. Nìkterá letadla mají toti¾ tendenci v~dùsledku rùznì velkého odporu na køídlech (napøíklad pokud letadlo automaticky nenastavuje klapky do vzájemnì opaèných poloh) \textit{sklouzávat} po pøídi nebo zádi do støedu pomyslného ku¾ele po jeho¾ vnitøní stìnì letadlo zatáèkou prolétává. Vý¹kové kormidlo mù¾e zatáèecí manévr doplnit na vzestupný èi sestupný.



\section{Stabilita letadla}

\note{TODO: revize}

Ka¾dé letadlo má svou konstrukcí dané stabilizaèní schopnosti, které se uplatòují ani¾ by pilot zasahoval do øízení. Stabilitu dìlíme na statickou a dynamickou.

Statická stabilita popisuje reakci letadla ve chvíli kdy dojde k~naru¹ení jeho dosavadního smìru letu napøíklad poryvem vìtru. U~staticky stabilního letadla vznikne opaèná síla sna¾ící se letadlo vrátit do pùvodní polohy. Staticky neutrální letadlo bude pokraèovat v~pozmìnìném smìru a u~staticky nestabilního letadla se dokonce objeví síla pùsobící spolu s~ru¹ivým vlivem, která odklon od pùvodního smìru je¹tì více posílí.

Dynamická stabilita popisuje stabilitu letadla v~dlouhodobém horizontu. Dynamicky stabilní letadlo sice bude pøi vyrovnávání svého smìru oscilovat kolem rovnová¾né polohy (vodorovného letu), ale po èase se v~nìm ustálí. Dynamicky neutrální letadlo bude oscilovat s~poøád stejnou sílou a dynamicky nestabilní letadlo bude od rovnová¾né polohy dokonce divergovat.

Letadlo které je staticky i dynamicky stabilní je vìt¹inou snáze ovladatelné a vhodné pro zaèínající piloty. Pokud je v¹ak tendence letadla dosáhnout stabilní polohy pøíli¹ velká, mù¾e to být ke ¹kodì, nebo» bude k~ovládání letadla nutné vynalo¾it vy¹¹í sílu. Aè se to nemusí zdát, není v¾dy cílem zkonstruovat dokonale stabilní letadlo a v~nìkterých pøípadech mù¾e být vhodné pokud se letadlo chová neutrálnì nebo dokonce nestabilnì.




\section{Herní ovládání letadla}

\note{TODO: zmínit pou¾ití kvaternionù}
\note{TODO: revize}

V~následujících podkapitolách bude popsáno zapojení vý¹e vysvìtlených mechanik letu do leteckých her. Zamìøím se pøitom pøedev¹ím na takzvané \textit{causual} hry, tedy oddechové hry které od hráèe nevy¾adují vysokou úroveò zku¹eností. U~her a programù profilujících se jako simulátory je zøejmá snaha co nejvíce se pøiblí¾it reálné pøedloze jak u~letové dynamiky, tak i z~hlediska ovládání letadla. I~pøesto lze u~simulátorù pozorovat vyu¾ití nìkterých zjednodu¹ení zejména z~oblasti ovládání.


\subsection{Chování letadla}

\note{TODO: revize}
V~pøedchozích kapitolách byla zmínìna slo¾itost numericky pøesného výpoètu v¹ech sil pùsobících na letadlo. Nejen ¾e by bylo potøeba znát a¾ desítky reálných koeficientù pro ka¾dý jeden typ letadla, ale po¾adavky na výpoèetní výkon by byly velmi vysoké (tím spí¹e pokud uva¾ujeme mobilní zaøízení). Proto se v~pøípadì leteckých simulátorù a her pou¾ívají matematické modely s~rùznou úrovní vìrnosti fyzikální pøedloze \cite{simulationModels}.

Je pochopitelné, ¾e v~pøípadì simulátorù pro prvotní výcvik pilotù je maximální vìrnost simulace nezbytná. V~pøípadì leteckých her se v¹ak ukazuje, ¾e pøíli¹ reálnì ovládané letadlo je spí¹e na obtí¾. Hráè causual her neumí a èasto ani nechce umìt plnohodnotnì ovládat letadlo. Jeho prvotním cílem je splnìní herních úkolù, typicky sestøelení protivníka nebo let na dané místo. Letadlo je v~této kategorii her pouze prostøedkem k~dosa¾ení cíle, nikoliv cílem samotným.

Do matematických modelù se proto vkládají zjednodu¹ující pøedpoklady, jako napøíklad stabilita letadla pøi zatáèení. To potom nemá tendence v~zatáèce sklouzávat do jejího støedu (tento jev byl detailnìji popsán v~kapitole \ref{sec:let-skutecneho-letadla}). Èastým zjednodu¹ením je také nemo¾nost dosáhnout bodu pøeta¾ení (opìt viz kap. \ref{sec:let-skutecneho-letadla}). Pomyslný omezovaè nedovolí dal¹í zvy¹ování úhlu nábìhu a letadlo pøeta¾ení nikdy nedosáhne. Tím odpadne èást simulace, kdy se letadlo ocitá ve vzduchu s~minimálním nebo ¾ádným vztlakem a mìlo by zaèít padat. Jeliko¾ v¹ak bì¾ný hráè nemá nejmen¹í ponìtí o~úhlu nábìhu a jeho dùsledcích na let, je tohoto zjednodu¹ení èasto vyu¾íváno. Nevýhodou tohoto pøístupu mù¾e být pro hráèe viditelné omezení manévrovacích mo¾ností. Pokud se ale stále dr¾íme v~kategorii her které se nesna¾í býti skuteènými simulátory, není tento problém nijak záva¾ný. Navíc lze vhodným návrhem hry takové omezení ospravedlnit, napøíklad pou¾itím grafického modelu letadla který v~hráèi vyvolá dojem tì¾kopádnosti a nízkého výkonu. Od takového letadla potom podvìdomì nebude oèekávat velké manévrovací schopnosti a snáze pochopí, kdy¾ narazí na jejich hranice, které ve skuteènosti slou¾í primárnì ke zjednodu¹ení celého výpoètu.

Podobnì lze mlèky pøedpokládat existenci nìjakého inteligentního øízení, které hráèi asistuje. To mù¾e kontrolovat dal¹í ovládací prvky letadla slou¾ící zejména ke zjednodu¹ení práce pilota v~nìkterých specifických situacích. (Jde mimo jiné o~tzv. \textit{sekundární ovládací prvky}, jejich¾ popis je v¹ak nad rámec této práce.) Takový pomocný systém je zcela jistì reálný a mù¾eme na nìj nahlí¾et jako na jistou formu autopilota.

\vspace{\baselineskip}

Z~pohledu ovládání letadla se hry v~drtivé vìt¹inì omezují výhradnì na klapky na køídlech a vý¹kové kormidlo. Pokud uva¾ujeme zmínìné \textit{asistované øízení}, lze tìmito dvìma prvky letadlo plnohodnotnì (stále pouze z~hlediska hry, nikoliv simulátoru) ovládat. V~nìkterých pøípadech bývá doplnìna i mo¾nost ovládání smìrového kormidla. U~nìj v¹ak nastává èasté nepochopení jeho funkce a bývá implementováno jako mo¾nost zatáèení letadla bez náklonu pøi zachování vodorovného letu. Takové letadlo pak zatáèí podobnì jako napøíklad ponorka. Je otázkou, zda toto pramení z~neznalosti vývojáøe hry anebo zda jde o~objednávku samotných hráèù. Prùlet zatáèkou je toti¾ pøi pou¾ití \textit{nepochopeného} smìrového kormidla mnohem snaz¹í, dává hráèi vìt¹í kontrolu nad letadlem a pøirozenì sni¾uje po¾adavky na hráèovu zruènost. Ve výsledku zále¾í na herním vývojáøi a na návrhu a zamìøení hry, zda se bude dr¾et reálného (by» zjednodu¹eného) ovládání letadla anebo se podvolí poptávce po snadno ovládaném letadle, pøesto¾e by tím popíral fyzikální zákonitosti.

V~neposlední øadì u~vìt¹iny leteckých her chybí mo¾nost regulovat tah motoru. To je velièina se kterou pilot skuteèného letadla v~prùbìhu letu a pøedev¹ím pak manévrù aktivnì pracuje. Je ale také jednou z~velièin ovlivòujících celkový vztlak letadla a pøi neznalosti v¹ech dùsledkù by pro hráèe bylo snadné ztratit nad letadlem kontrolu. Stejnì tak se èasto ignoruje døíve zmiòovaná zmìna citlivosti ovládacích prvkù letadla v~závislosti na tahu motoru. Obvyklým øe¹ením bývá opìt pøedpoklad existence nìjakého palubního systému který tah motoru automaticky reguluje. Ve výsledku bývá v~prùbìhu letu tah konstantní a k~jeho zmìnám dochází pouze pøi vzletu nebo pøistávání. Èasto také informace o~otáèkách motoru úplnì chybí a jedinou zpìtnou vazbou hráèi je zvuk který motor vydává.




\subsection{Vstupní metody}
\label{sec:vstupni-metody}

\note{TODO: revize}

Pokud se podíváme na letecké hry pro poèítaèe, pøípadnì pro herní konzole, jsou ovládací mo¾nosti vcelku omezené. Prakticky v¾dy se omezují na ovládání ve dvou osách, kdy pohyb v~jedné ose øídí klapky na køídlech letadla a pohyb v~druhé ose ovládá vý¹kové kormidlo. Subjektivnì je asi nejménì pohodlnou a souèasnì nejménì pøesnou metodou ovládání klávesnice poèítaèe. Reakce na øízení jsou z~povahy kláves skokové a nelze ovlivòovat jejich intenzitu. Pozitivem pou¾ití klávesnice mù¾e být velké mno¾ství kláves, které mù¾ou ovládat dal¹í prvky letadla. Tyto mo¾nosti v¹ak vyu¾ijí spí¹e simulátory.

O~mnoho lep¹í kontrolu nabízí joystick, pøípadnì jeho zmen¹ená varianta na ovladaèích souèasných herních konzolí. Ovládání je opìt dvouosé, ov¹em s~mo¾ností plynule regulovat intenzitu. Nejdùle¾itìj¹í vlastností je ale podobnost se skuteèným øízením letadla pomocí kniplu. To umo¾òuje pøedev¹ím v~pøípadì joysticku mnohem vy¹¹í vtáhnutí hráèe do hry. Nevýhodou mù¾e být omezený poèet doplòkových ovládacích prvkù, typicky je na ovladaèi pouze nìkolik málo dal¹ích tlaèítek. Pokud by hra nabízela mo¾nost detailnìj¹ího ovládání letadla (napøíklad vysouvání podvozku nebo vypou¹tìní svìtlic pro odlákání nepøátelských støel), mohl by to být problém.

\vspace{\baselineskip}

Roz¹íøení výkonných mobilních zaøízení umo¾nilo pøíchod nových metod ovládání. Mù¾eme ignorovat generaci mobilních telefonù s~klávesnicí, jeliko¾ ty je¹tì nemìly dostatek výkonu a k~roz¹íøení leteckých her u~nich nedo¹lo, a zamìøme se pouze na zaøízení s~velkým dotykovým displejem. Taková zaøízení èasto nemají hardwarová tlaèítka nebo taková tlaèítka slou¾í systému a hra je pro své potøeby nemù¾e vyu¾ít. Novým prvkem je ale zapojení sensorù. Konkrétnì gyroskopu a akcelerometru, které sledují orientaci, respektive zrychlení zaøízení v~trojrozmìrném prostoru. Hráè ovládá letadlo naklánìním zaøízení pøièem¾ se typicky neuva¾uje svislá osa. Natoèení do stran (pohyb podobný zatáèení volantem) ovládá klapky letadla a naklonìní od sebe èi k~sobì ovládá vý¹kové kormidlo.

Ovládání her pomocí sensorù se rychle roz¹íøilo pravdìpodobnì díky své inovativnosti a v~souèasnosti si udr¾uje pøinejmen¹ím u~leteckých her vìt¹inový podíl. Má v¹ak také nìkolik nedostatkù. Asi nejzásadnìj¹ím je výchozí pozice zaøízení. Pøi pou¾ívání sensorù je potøeba stanovit referenèní bod ke kterému namìøené hodnoty vztahujeme. Èastým øe¹ením je nastavit bod na zaèátku ka¾dého letu, poté se ji¾ mìnit pøirozenì nemù¾e. Problém nastává ve chvíli, kdy se hráè hrající hru sám pohybuje ve skuteèném svìtì. Mù¾e jít napøíklad o~houpání se v~køesle anebo pøesun v~nìjakém dopravním prostøedku. Hry se v~takovém pøípadì stávají nehratelnými a zatím se neobjevila metoda, která by umìla tento jev odstranit. 

Druhý nedostatek stojící za zmínku je zmìna úhlu pohledu pøi pohybu se zaøízením. Displeje mají vìt¹inou relativnì velký pozorovací úhel, i tak ale mù¾e docházet ke sni¾ování viditelnosti pokud je zaøízení a¾ moc pøiklonìno, respektive odklonìno od pohledu hráèe. Øe¹ením mù¾e být vhodná volba citlivosti tak, aby staèilo zaøízení naklánìt jen v~\textit{pohledovì bezpeèném} rozsahu. Stejnì tak mù¾e být problémové i otáèení displeje. Pøesto¾e zde se úhel pohledu nemìní, dochází k~otáèení celého obrazu vèetnì u¾ivatelského rozhraní. Na tuto skuteènost je nutné myslet pøi návrhu hry tak, aby u¾ivatel ¹patnou èitelností prvkù rozhraní nepøicházel o~dùle¾ité informace.

Dal¹ím problémem je relativnì pomalá odezva sensorického vstupu a tvar jeho prùbìhu. Zpo¾dìní není zásadní, ale je pozorovatelné. Hru je navíc mo¾né navrhnout tak, aby pro hráèe bylo pochopitelné. Pøi letu s~velkým tì¾kopádným letadlem asi nikdo nebude oèekávat reakce v~øádu zlomkù vteøiny. U~rychlých a akèních her by v¹ak toto mohlo být omezující. Prùbìh signálu vznikajícího v~sensoru navíc není ideální a bì¾nì obsahuje výkyvy a ¹um. Je proto nutné jej filtrovat, èím¾ mù¾e docházet ke ztrátì pøesnosti.

Poslední slabinou sensorového ovládání je spoleèenská vhodnost. S~tím jak se herní zaøízení stala mobilními se roz¹íøila i místa kde mù¾e èlovìk hry hrát. Ne v¾dy a v¹ude bude okolí tolerovat hráèe který pøed sebou mává mobilním telefonem èi tabletem. Vývojáø sice nemù¾e ovlivnit na jakých místech budou hráèi jeho hru hrát, mù¾e se v¹ak pøinejmen¹ím zamyslet kdo bude cílovou skupinou a nakolik jsou èlenové této skupiny ochotní se ve spoleènosti tímto zpùsobem zviditelòovat.

\begin{figure}[ht]
	\begin{center}
		\includegraphics[width=\textwidth]{fig/race-pilot.png}
		\caption{Screenshot hry Race Pilot ovládané pomocí sensorù. ©edé ètverce po stranách ovládají smìrové kormidlo, které je v¹ak implementováno nesprávnì}
		\label{fig:racepilot}
	\end{center}
\end{figure}

\vspace{\baselineskip}

Z~pohledu mobilních zaøízení je asi nejzásadnìj¹í mo¾nost ovládání dotykem. Ta se neomezuje pouze na tlaèítka a polohovací páèky a je zde mo¾né navrhnout témìø libovolné ovládací prvky. K~tomu lze vyu¾ít polo¾ení prstu na displej, který odpovídá stisku klávesy, a mù¾e tedy øídit dvoustavové velièiny. Souèasnì je mo¾né sledovat pohyb jednoho èi více prstù v~nìjaké pøedem dané oblasti a získávat plynulé zmìny hodnoty (napøíklad vzdálenost bodu dotyku od referenèního bodu). Dal¹ím velmi silným prostøedkem je vzájemná poloha dvou a více bodù dotyku.

Ve srovnání se sensorickým ovládáním netrpí zmiòovanými nedostatky jako je nutné natáèení a naklánìní zaøízení a nepou¾itelnost v~pøípadì ¾e je hráè v~pohybu. Pøi návrhu dotykového ovládání je v¹ak nutné poèítat s~tím, ¾e hráè mù¾e svými prsty pøekrývat znaènou èást displeje. To se mù¾e projevit zejména u~displejù s~men¹í úhlopøíèkou. Stejnì tak je vhodné se pøi návrhu ovládání zamý¹let nad tím, kdo bude typickým hráèem hry. Zcela jistì bude rozdíl mezi prstem dítìte a dospìlého jedince, navíc s~pøihlédnutím k~vykonávané profesi, a je nutné tomuto ovládací metodu pøizpùsobit.

Pøesto¾e se zdá ¾e právì dotykové ovládání nabízí ¹iroké mo¾nosti pro inovace, herní vývojáøi je zatím spí¹e nevyu¾ívají. V~pøípadì leteckých her drtivì pøevládá vyu¾ití sensorù, pøípadnì dotykového ovladaèe na displeji -- bodu který hráè dotykem posouvá a simuluje tak pohyb joysticku.











\chapter{Návrh dotykového ovládání a letecké hry}

\note{TODO: jak se letadlo pohybuje? hodit pár vzorcù?}

V~této èásti práce popí¹i novì navrhovanou metodu ovládání a varianty její implementace. Dále rozvedu jak by mìla výsledná hra vypadat a jaké budou její herní mechanismy.  Stále je potøeba mít na pamìti, ¾e se pohybujeme v~oblasti her pro mobilní zaøízení. Rozmìry obrazovek, tedy ovládacích ploch, budou omezené, stejnì jako výkon zaøízení. Stejnì tak povaha práce s mobilním zaøízením je diametrálnì odli¹ná od povahy práce s bì¾ným poèítaèem nebo herní konzolí. Tyto faktory bude nutné uvá¾it.

Pøi navrhování hry jsem vycházel zejména z~\cite{gameindustry1} a \cite{gameindustry2}.




\section{Novì navrhovaná metoda ovládání}
\label{sec:nova-metoda-ovladani} 

\note{OK r1, kromì obrázkù}
\note{TODO: pøidat i ovládání smìrovky - odkazuje sem prototyp}

Pøi uva¾ování o~inovativním pøístupu k~ovládání letadla jsem témìø okam¾itì vyøadil vstup pomocí sensorù. Dùvody zmínìné v kapitole \ref{sec:vstupni-metody} mi pøijdou pøíli¹ omezující. Souèasnì v~této oblasti nejsou velké mo¾nosti k~dal¹ímu roz¹iøování tak, aby pro hráèe zùstala zachovaná pohodlnost a intuitivnost ovládání.

Navrhované ovládání tedy bude èistì dotykové. Tím bude mo¾né jej pou¾ívat kdekoliv a jeho hlavními pøednostmi bude vysoká pøesnost a rychlá odezva. Díky tomu na nìm pùjde vystavìt i velmi rychlou a akèní hru. Oproti existujícímu dotykovému vstupu by mìlo hráèi nabídnou vìt¹í vta¾ení do dìje a snad i navodit pocit jisté jedineènosti, tedy ¾e hráè pou¾ívá nìco nového a neobvyklého. Proti této my¹lence jde èásteènì po¾adavek na nízké znalosti a zku¹enosti. Hráè by mìl princip ovládání pochopit prakticky ihned, v~nejlep¹ím pøípadì pak bez jakékoliv nápovìdy nebo pøedchozího pro¹kolení. Souèasnì musí být ovládání maximálnì pohodlné. To toti¾ opìt není cílem hry, ale pouze prostøedkem k~jeho dosa¾ení. V~ideálním pøípadì by mìlo být pro hráèe natolik pøirozené, ¾e nad ním nebude muset pøemý¹let èi je¹tì lépe vùbec si uvìdomovat jeho existenci. Pochopitelnì jej také nesmí omezovat a mìlo by postihnout v¹echny podstatné funkce ovládaného objektu, v~tomto pøípadì letadla.

\vspace{\baselineskip}

Pro dal¹í popis rozdìlím ovládání do jednotlivých os. První z~nich bude osa ovládající klapky na køídlech a tím i náklon celého letadla, tedy rotaci kolem osy definované smìrem letu. V~pøípadì joysticku a z~nìj vycházejících metod jde o~pohyb ukazatele èi ovladaèe do stran. Navrhovaná metoda ovládání vy¾aduje aby existovaly právì dva body ve kterých se hráè dotýká displeje. Tyto se pou¾ijí k~sestrojení pomyslné kru¾nice, její¾ støed bude le¾et na støedu úseèky definované obìma body. Úhel náklonu letadla pak odpovídá úhlu o~který se spojnice bodù odchyluje od vodorovné osy kru¾nice. Situace je zachycená na obrázku \ref{fig:ovladani-roll}. Aèkoliv to z~popisu nemusí být zøejmé, na polomìru kru¾nice ve skuteènosti vùbec nezále¾í. Hráè mù¾e prùbì¾nì vzdálenost bodù mìnit a pokud oba body zùstanou na pùvodní úseèce, náklon letadla se nezmìní. Vedlej¹ím efektem je pak mo¾nost takto mìnit citlivost ovládání. Zatímco u~kru¾nice o~velkém polomìru je mo¾né dosáhnout velmi jemné regulace náklonu, pøi pøibli¾ování bodù a zmen¹ování polomìru se citlivost pøirozenì zvy¹uje. Dùle¾ité je, ¾e nezále¾í na pozici kru¾nice v~rámci dotykové plochy a v~ka¾dém okam¾iku se vytváøí tak, aby její støed le¾el ve støedu spojnice mezi obìma body dotyku. V¹echny dvojice protilehlých bodù takové kru¾nice pak definují manévrovací mo¾nosti v dané ose rotace. Ty budou bez dal¹ích omezení odpovídat $360°$. Pro ovládání letadla v¹ak bude vhodnìj¹í pou¾ít rozsah $-180°--180°$, kde nulový úhel náklonu bude odpovídat vodorovné ose obrazovky. (Pøesto¾e se tato práce soutøeïuje na letecké hry, je jistì mo¾né navrhovanou metodu ovládání pou¾ít pro ovládání zcela jiných objektù. V takovém pøípadì mù¾ou být vhodné rozsahy vstupù, stejnì jako neutrální poloha, pochopitelnì odli¹né.) V zájmu sjednocení rozsahù vstupních hodnot z obou os bude posledním krokem pøevod do rozsahu $-1$ a¾ $1$, kde opìt $0$ pøedstavuje neutrální hodnotu.

Je vhodné zde také zdùraznit, ¾e rozsah hodnot ovládání nemusí pøímo odpovídat silám aplikovaným na ovládaný objekt. V pøípadì letadla si lze hodnoty ovládání pøedstavit jako úroveò pøita¾ení kniplu nebo se¹lápnutí pedálu. Jde o bezrozmìrné hodnoty a teprve jejich \textit{dosazením} na vstup konkrétního matematického modelu letadla vzniknou síly na nìj aplikované. To odpovídá skuteènosti, kde malé letecké letadlo pou¾ívá rámcovì stejné základní ovládací prvky jako napøíklad velký dopravní letoun. A teprve rozmìry a ostatní charakteristiky ovládacích ploch letadla urèují, jak moc letadlo zmìní smìr svého letu.


\note{TODO: hezèí obrázek?}
\begin{figure}[ht]
	\begin{center}
		\includegraphics[scale=0.4]{fig/controls-roll.png}
		\caption{Ovládání náklonu letadla, èervená místa znaèí body dotyku}
		\label{fig:ovladani-roll}
	\end{center}
\end{figure}

Druhou z~ovládaných velièin je vý¹kové kormidlo. To bývá u~joysticku a podobných metod reprezentováno pøitáhnutím nebo odtlaèením ovládací páèky. Princip nastiòuje obrázek \ref{fig:ovladani-pitch}. Opìt zde pracujeme se støedem úseèky mezi dvìma body dotyku a odeèítáme jeho vzdálenost od referenèního bodu, který je na obrázku znázornìn uprostøed displeje. Støed displeje je zvolen pouze pro ilustraci a ve skuteènosti se referenèní bod pøemístí poka¾dé kdy¾ se displeje zaènou dotýkat právì dva prsty. V~okam¾ik prvotního dotyku se referenèní bod nastaví a nemìní se dokud se oba prsty nepøestanou displeje dotýkat. Jakmile se znovu dotknou, referenèní bod se pøesune na novou pozici na které opìt po dobu kontaktu prstù s~displejem zùstává. Hráè tak pøi pouhém polo¾ení prstù na displej bez dal¹ího pohybu nijak nezasahuje do ovládání letadla. Souèasnì tento pøístup umo¾òuje hráèi zaèít letadlo ovládat dotykem v~libovolné èásti displeje, co¾ mù¾e být výhodné zejména u~tabletù a obecnì zaøízení s~vìt¹í úhlopøíèkou dotykové plochy.

Funkèní rozsah tohoto vstupu bude omezený hranami obrazovky. Zde se nabízí více øe¹ení problému. Je mo¾né jako rozsah definovat celou vý¹ku obrazovky. V místì prvotního dotyku se pak nastaví neutrální hladina s tím, ¾e obì oblasti (kladná i záporná) budou mít stále vý¹ku poloviny obrazovky, tøeba¾e by zasahovaly mimo oblast obrazovky. Takový pøístup nabízí optimální chování v situaci, kdy prvotní dotyk nastává právì v polovinì vý¹ky obrazovky. V ostatních pozicích dochází k oøíznutí rozsahu a tím ke zhor¹ení manévrovacích mo¾ností. Jiným pøístupem mù¾e být zmen¹ení vý¹ky oblastí tak, aby ¾ádná z nich nepøesahovala oblast obrazovky. Obì ovládací oblasti by samozøejmì mìly být shodnì velké, a rozmìr by se tedy øídil podle men¹í z nich. Slabinou tohoto pøístupu je rùzná citlivost vstupu v závislosti na místì prvotního dotyku. Optimální chování je opìt v oblasti kolem støedu obrazovky, s klesající vzdáleností k jejímu okraji pak roste citlivost a¾ do místa, kde vstup pøestává být pou¾itelný.

Konkrétní implementace vý¹kového kormidla mù¾e opìt záviset na povaze ovládaného objektu. V pøípadì této práce jsem experimentoval s více variantami. Více k tomuto tématu bude popsáno v kapitole \ref{sec:implementace-prototypu}.

\vspace{\baselineskip}

\note{TODO: hezèí obrázek?}
\begin{figure}[ht]
	\begin{center}
		\includegraphics[scale=0.4]{fig/controls-pitch.png}
		\caption{Ovládání vzestupu nebo poklesu letadla, èervená místa znaèí body dotyku}
		\label{fig:ovladani-pitch}
	\end{center}
\end{figure}

Kombinací tìchto dvou principù vzniká ovládání schopné pokrýt stejný rozsah velièin jako zmiòovaný \textit{klasický dotykový} anebo sensorový vstup. Skládá se pøitom ze známých prvkù -- ovládání náklonu mù¾e hráèi evokovat zatáèení volantem, zmìna vý¹ky pak gesto bì¾nì pou¾ívané pro svislé posouvání obsahu. Je proto mo¾né pøedpokládat, ¾e navrhované ovládání bude pro hráèe skuteènì intuitivní a k~jeho vysvìtlení nebude potøeba více ne¾ dva nákresy uvedené v~této kapitole.




\section{®ánrové zaøazení a herní mechanismy}
\label{sec:zanrove-zarazeni} 

\note{OK r1}

Hra se bude odehrávat v~prostøedí leteckých závodù. Hráè je v~roli pilota akrobatického letadla který nav¹tìvuje jednotlivé závody. Samotný závod pak spoèívá v~prùletu branek ve stanoveném poøadí (pøesná dráha letu se nevy¾aduje), vzlet ani pøistávání se neuva¾uje. Branky mù¾ou být rùzného typu: obyèejná, jednosmìrná nebo branka vy¾adující prùlet v~pøedem dané poloze letadla. Právì poslední typ branky je typickým prvkem leteckých závodù, kdy nezále¾í pouze na èasu letu, ale hodnotí se také pøesnost se kterou pilot brankou proletí. Rozli¹uje se prùlet vodorovný, svislý (takzvaný \textit{no¾ový let}) a prùlet vzhùru nohama.

Cílem hráèe je proletìt v¹emi brankami v~co nejkrat¹ím èase. Pøi prùletu brankou vy¾adující konkrétní polohu letadla se kontroluje pøesnost prùletu. Pokud je nízká, pøiète se k~èasu prùletu postih závisející na velikosti odchylky. Prùlet brankou se v¹ak zapoèítá i v~pøípadì, ¾e bude odchylka maximální. To je rozdíl oproti jednosmìrné brance, která se pova¾uje za splnìnou pouze pøi prùletu ze správného smìru. U~obyèejné branky ¾ádná omezení ani postihy nejsou. U~ka¾dého závodu jsou definovány tøi èasy prùletù, které se hráè sna¾í pøekonat. Tyto èasy vzniknou pravdìpodobnì v~prvotní fázi odhadem, pozdìji se upraví na základì testování a zpìtné vazby od hráèù.

Celá hra se pak sestává s~mno¾ství závodù, kde ka¾dý se mù¾e odehrávat v~jiném grafickém prostøedí (ne v¹ak nutnì v¾dy unikátním). Jednotlivé závody spolu ale nijak nesouvisejí. Na zaèátku má hráè zpøístupnìný jediný závod do kterého mù¾e vstoupit, ostatní závody jsou uzamèené. Ve chvíli kdy hráè v~nìkterém ze závodù pøekoná alespoò jeden z~pøeddefinovaných èasù, pova¾uje se závod za splnìný a zpøístupní se jeden dal¹í závod. Nezbytným pøedpokladem pro plynulý prùchod v¹emi závody bude postupnì se zvy¹ující obtí¾nost. Tak jako porostou zku¹enosti a dovednosti hráèe, musí stoupat i velikost výzvy pøed kterou je postaven. V pøípadì pøíli¹ jednoduchých závodù by hráè procházel bez nejme¹ího odporu a hra by byla nudná. U pøíli¹ obtí¾ných závodù by se naopak hráè mohl zaseknout bez mo¾nosti pokraèovat dál. Motivací pro nejlep¹í mo¾né splnìní závodu, tedy pøekonání nejni¾¹ího z~èasù, pak mohou být speciální odmìny, jako napøíklad nové letadlo nebo jiné dekorativní prvky. 

V poèáteèní fázi (tedy prvních vydaných verzích hry) není ¾ádoucí zpøístupnit hráèi více letadel s rùzným výkonem, tøeba¾e by se takové letadlo nabízelo jako vhodná odmìna za vynikající výkony. Taková mo¾nost by toti¾ zvý¹ila obtí¾nost odhadu pøimìøené nároènosti závodu. Lze jistì pøedpokládat, ¾e hráèi nováèkovi potrvá nìjakou dobu, ne¾ dostane letadlo plnì pod kontrolu a nauèí se jej ve v¹ech situacích bezpeènì ovládat. V takové situaci není nutné hráèe zatì¾ovat úvahami o rychlosti èi ovladatelnosti letadla. Naopak bude vhodné nabídnout pouze jediné letadlo a hráèe odmìòovat právì formou dekorativních úprav, napøíklad jiného laku (tedy textury) letadla.

Uvedení rùznì výkonných a ovladatelných letadel mù¾e pøijít ve chvíli, kdy bude mo¾né pøedpokládat jistou zku¹enost hráèe. Takový hráè u¾ letadlo plnì ovládá a hlavná výzva závodù se pøesouvá od schopnosti proletìt v¹echny branky (v témìø libovolném èase) k cíli proletìt je co nejrychleji. Zde bude mo¾né zpøísnit po¾adavky na rychlost prùletu závodem, vèetnì mo¾nosti definovat èasy na první pohled nesplnitelnì. To hráèe pøinutí vrátit se k døívìj¹ím závodùm, dosáhnout v nich nejlep¹ího hodnocení (to by v této chvíli mìl zvládnout, nebo» jeho zku¹enosti vzrostly) a odmìnou získat rychlej¹í letadlo, se kterým ji¾ bude mo¾né plnit obtí¾nìj¹í závody.

\vspace{\baselineskip}

Celkovì by hra mìla pùsobit akènì a rychle, èemu¾ musí odpovídat i metoda ovládání. Právì u~akrobatických letù je potøeba aby odezva na vstup byla minimální a hráè neustále cítil ¾e má letadlo plnì pod kontrolou. Takovouto hru by zcela jistì bylo velmi obtí¾né ovládat pomocí sensorického vstupu, a je proto dobrým prostøedkem pro prezentaci pøedností novì navrhovaného ovládání.

\note{TODO: obrázek? tøeba výbìr levelù}



\section{Roz¹iøitelnost}

\note{OK r1}

Podstatným faktorem je také následná roz¹iøitelnost hry. Aktualizace aplikace se nemusí zamìøovat pouze na opravování chyb, ale mohou souèasnì pøidávat dal¹í herní obsah. To je z~pohledu hráèe velmi ¾ádoucí a právì informaci o~aktualizaci mu mù¾e pøipomenout dávno dohranou hru. Aktualizace se pak stávají men¹inovým propagaèním nástrojem a je velmi ¾ádoucí s~nimi takto pracovat. Pøíli¹ èasté vydávání nových verzí mù¾e být obtì¾ující, zejména pokud hráè vìt¹inu herního obsahu zkonzumoval a nového se mu nedostává. I~v~pøípadì ¾e má vývojáø vìt¹í mno¾ství nevydaného obsahu, je vhodné jeho zveøejòování dávkovat a sna¾it se tak udr¾ovat dlouhodobý zájem o~hru.

Konkrétnì u~navrhované hry je relativnì jednoduché doplnit dal¹í herní re¾imy. Ve chvíli kdy je implementováno ovládání letadla a jeho interakce s~herním svìtem, je jen otázkou témìø triviální logiky, zda se budou poèítat body za prolétnuté branky nebo zda bude cílem proletìt trasu v~co nejkrat¹ím èase, pøípadnì cokoliv jiného.

Podobnì je tomu v~pøípadì vytváøení nových herních úrovní, tedy závodù. Hra nepoèítá s~unikátním prostøedím pro ka¾dý jeden závod a scenérie se nutnì budou opakovat. Nejjednodu¹¹ím doplnìním obsahu tedy mù¾e být vyu¾ití existujícího prostøedí a vytvoøení pouze nové sady branek. O~nìco nároènìj¹ím roz¹íøením by pak bylo doplnìní nového prostøedí. Tam je nároènost zejména na stranì grafických prací. Tímto zpùsobem je mo¾né pøipravovat tématické balíèky s~novými úrovnìmi k~rùzným významným pøíle¾itostem, co¾ mù¾e být opìt zajímavý propagaèní prvek.

Z tohoto hlediska nebude nutné implementovat v¹echny herní mechanismy z pøedchozí kapitoly ihned. S ohledem na èasové mo¾nosti a zmínìného dávkování obsahu mù¾e být dokonce vhodné zaèít s jednoduchou hrou a tu následnì roz¹iøovat. Zpìtná vazba od hráèù a informace získané ze statistik u¾ívání pak mohou poskytnout indicie k tomu, kterým smìrem hru dále vyvíjet. Souèasnì se v pøípadì neúspìchu minimalizuje úsilí vynalo¾ené k vytvoøení hry, a tím tedy i ztráty.

V neposlední øadì je potøeba uva¾ovat o monetizaci hry, tedy o její ziskovosti. Vzhledem k vý¹e popsaným mechanismùm se nabízí jako vhodné øe¹ení zpoplatnìní nìkterých závodù, pøípadnì mo¾nost zakoupit si pøedèasnì nìkteré odmìny. Opìt ale bude potøeba dbát na vyvá¾enost hry a zachování její zábavnosti. Nelze proto hráèi ihned nabídnout vykonnìj¹í letadlo, tøeba¾e za poplatek. Vhodnìj¹í bude poèkat do chvíle, kdy by toto letadlo mohl získat pøirozenì a teprve poté jej nabídnout ke koupi.









\chapter{Implementace a publikování hry}

V této èásti popí¹i implementaci navr¾eného ovládání a hry. Ve¹kerá práce probíhala ve vývojovém prostøedí Eclipse, doplnìné o moduly specifické pro platformu Android. Tyto doplòky jsou souèástí podkladù pro vývojáøe a jsou dostupné z oficiálních webových stránek. 

Poslední podkapitola bude vìnovaná publikování vytvoøené hry nejdøíve v omezené skupinì lidí a následnì na internetovém obchodì Google Play (oficiální obchod s aplikacemi spravovaný pøímo firmou Google). Zhodnotím také výsledky testování, prùzkumù a poznatky získané sbìrem statistik u¾ívání. V závìru kapitoly také shrnu mo¾nosti dal¹ího vývoje.




\section{Prototyp a prvotní testování}
\label{sec:implementace-prototypu} 

V poèátku práce na aplikaci jsem navrhl a impementoval prototyp zalo¾ený èistì na platformì Android, bez pou¾ití dal¹ích knihoven. Potýkal jsem se s problémy, které byly popsány v kapitole \ref{sec:negativna-nativniho-vyvoje}, a zpìtnì lze prohlásit, ¾e vývoj bez pomocných nástrojù èi knihoven bude pøinejmen¹ím velmi obtí¾ný. 

Cílem prototypu byla prvotní implementace navr¾ného ovládání a validace jeho funkcionality. Obecnì by mìlo jít o maximálnì zjednodu¹enou verzi aplikace, kde bude mo¾né velmi rychle doplnit libovolnou funkcionalitu, pøedev¹ím z hlediska vstupních metod. Pøesto¾e mìl být prototyp takøka jednoúèelovou aplikací, jeho vnitøní struktura je v mnohém podobná struktuøe aplikace pou¾ívající knihovnu Libgdx. To je pravdìpodobnì z velké èásti dáno pøímo platformou Android, která se návrhem svého rozhraní (a samozøejmì i v¹emi ukázkovými pøíklady) sna¾í vést programátora ke správnì navr¾ené struktuøe aplikace. Správná struktura v tomto kontextu znamená aplikaci, která je vnitønì pøehledná a efektivní, její souèásti pak znovupou¾itelné a dobøe testovatelné. Tyto po¾adavky nemají v pøípadì prototypu velkou prioritu (snad s výjimkou znovupou¾itelnosti souèástí), pøesto je vhodné zmínit, ¾e jsem jich pøi práci na prototypu bez velkého úsilí dosáhl anebo se jim alespoò pøiblí¾il.

Z pohledu u¾ivatele je prototyp velmi omezenou verzí hry. Neobsahuje u¾ivatelské rozhraní, vizuální stránka je strohá a stejnì tak nejsou implementovány ani herní mechanismy týkající se závodù. Dalo by se øíct ¾e jde pouze o letadlo nekoneènì se pohybující v prostoru, nebo» detekce kolizí, a» u¾ s terénem anebo prùlet kruhy, v prototypu chybí také. Pro pøedstavu o prvotní verzi vizte obrázek \ref{fig:prototyp-1}. Pozdìji do hry pøibylo více vizuálních prvkù, pøedev¹ím model ostrova pro experimenty s terénem. Pro lep¹í pocit ze hry pøi jejím testování jsem také nahradil hlínu texturou vody. Závìreèná podoba prototypu je na obrázku \ref{fig:prototyp-2}. Kromì zmínìného ostrova bylo v prostoru rozmístìno i nìkolik kruhù, na kterých bylo mo¾né testovat ovladatelnost letadla zvolenou metodou.

\vspace{\baselineskip}

\begin{figure}[ht]
	\begin{center}
		\includegraphics[width=\textwidth]{fig/ingame-proto-1.jpg}
		\caption{Jedna z prvních verzí prototypu}
		\label{fig:prototyp-1}
	\end{center}
\end{figure}

Ovládacích metod obsahoval prototyp hned nìkolik. V zájmu rychlé implementace se k jejich výbìru pou¾ívá nativní menu platformy. V základu je zvolená ji¾ popsaná nová metoda ovládání a dále je mo¾no pøepnout na ovládání pomocí akcelerometru nebo virtuálního joysticku na obrazovce. Takto mohlo dojít k pøímému porovnání ovládacích metod. Souèasnì vznikaly i varianty jednotlivých metod s rùznou citlivostí nebo lehce odli¹ným chováním. To se týká pøedev¹ím navrhované metody, kde existuje více pøístupù, jak jsem popsal v kapitole \ref{sec:nova-metoda-ovladani}. Ukázalo se, ¾e je vhodnìj¹í pou¾ít variantu, kdy mají ovládací oblasti pevnì danou velikost v závislosti na rozli¹ení obrazovky, pøièem¾ pøípadný pøesah mimo zobrazovací oblast se ignoruje. Zjednodu¹enì lze øíct, ¾e tato metoda udr¾uje konstantní citlivost na úkor mo¾nosti dosáhnout v¾dy plného rozsahu ovladatelnosti. Ideální místo prvotního dotyku tedy bude pøesnì v polovinì vý¹ky obrazovky. Tuto informaci bude potøeba vhodným zpùsobem pøedat u¾ivateli a více tento problém popí¹i v kapitole \ref{sec:implementace-ui}.

Druhá popisovaná varianta mìnila rozmìry obládacích oblastí (a tím i citlivost) v závislosti na poloze prvotního dotyku tak, aby nikdy nepøesáhly okraje obrazovky. Tato verze se ukázala jako ménì vhodná. Pùvodní pøedpoklad, ¾e hráè bude mít v prùbìhu celého letu trvale polo¾ené prsty na obrazovce, se ukázal jako nesprávný. Hráèi mají naopak tendence prsty zvedat a opìtovnì se obrazovky dotýkat, co¾ mìní refrenèní hladinu pro ovládání. V pøípadì této varianty se navíc mìnila i citlivost a hráè ztrácel pøehled o tom, jakou odezvu pohyb jeho prstù vyvolá. Ovládání se tím stávalo slo¾ité a nepøirozené, proto jsem tuto variantu zavrhl.

\begin{figure}[ht]
	\begin{center}
		\includegraphics[width=\textwidth]{fig/ingame-proto-2.jpg}
		\caption{Závìreèná podoba prototypu}
		\label{fig:prototyp-2}
	\end{center}
\end{figure}

Podobnì jsem experimentoval i s ovládáním smìrového kormidla, jako¾to tøetí ovládané osy, jak bylo opìt popsáno v kapitole \ref{sec:nova-metoda-ovladani}. Tato varianta, by» návrhovì èistá a konzistentní s ostatními osami, se také ukázala jako nevhodná. Problémem zde nebyla nepøirozenost, ale pøedev¹ím komplexnost ovládání. Opìt pøipomínám, ¾e hra necílí na profesní piloty èi letecké modeláøe, ale na bì¾né hráèe. Ti bohu¾el v obecném mìøítku nejsou schopní ovládat letadlo ve více ne¾ dvou osách. Na druhou stranu se ukázalo, ¾e nìkteøí jednotlivci toto ovládání pova¾ují za vhodné, a dokonce by jej preferovali pøed ovládáním dvouosým. Lze o nìm proto uva¾ovat jako o mo¾ném volitelném roz¹íøení.

\vspace{\baselineskip}

Zmínìné testování probíhalo v prùbìhu vývoje prototypu a jednotlivých metod na vesmìs náhodném vzorku testerù. Nebylo v¹ak nijak organizované a neexistují z nìj ¾ádné záznamy, právì kvùli plynulému vývoji nezøetelným iteracím. Ne v¾dy tak bylo mo¾né nechat stejnou osobu srovnat varianty pøed a po úpravì. V této fázi by byl jistì prostor pro zlep¹ení. Detailnìj¹í testování jsem provedl pozdìji pøed zveøejnìním finální hry a blí¾e jej popí¹i v kapitole \ref{sec:verejne-testovani}. Pro úplnost doplním, ¾e vstup pomocí akcelerometru nebo virtuálního joysticku byl v drtivé vìt¹inì pøípadù oznaèen za ménì pohodlný a vzhledem k povaze hry také ménì vhodný.











\section{Struktura aplikace}
\note{Tato kapitola popí¹e... pøedstaví... vysvìtlí...}

\subsection{Oddìlení platforem}
\label{sec:oddeleni-platforem}

Jak ji¾ bylo naznaèeno v popisu knihovny Libgdx v kapitole \ref{sec:libgdx}, jednou z jejích výhod je pøenositelnost mezi platformami. Pro vytváøenou hru budou relevantní platformy Android a PC (bez rozdílu operaèního systému). V dobì psaní této práce existuje v knihovnì Libgdx také podpora platformy iOS, která se nachází na mobilních zaøízeních firmy Apple. Tato podpora je v¹ak ve velmi ranném stádiu a proces sestavení aplikace vy¾aduje proprietální software, vývojáøskou licenci a fyzické zaøízení dané platformy. Kvùli tìmto okolnostem jsem podporu iOS vylouèil. Z povahy pou¾ívané knihovny by ov¹em bylo pøidání podpory této platofrmy do ji¾ hotové hry triviální zále¾itostí.

\vspace{\baselineskip}

Pro dal¹í popis budu vyu¾ívat pojem \textit{projekt} tak, jak je chápán z hlediska vývojového prostøedí, zde programu Eclipse. Jeden projekt lze sestavit do jedné spustitelné aplikace èi knihovny. Doporuèeným postupem je zde vyèlenìní ve¹keré aplikaèní logiky do jednoho projektu, ze kterého sestavením vznikne knihovna. Tuto knihovnu vyu¾ívají ostatní projekty, v¾dy jeden pro ka¾dou cílovou platofrmu. Existence projektu pro platformu Android je vy¾adována. Z historických a praktických dùvodù jsou právì zde ulo¾eny ve¹keré datové soubory budoucí aplikace a varianty pro ostatní platformy se na tento obsah pouze odkazují (ke kopírování dat dochází a¾ pøi sestavování konkrétních aplikací). Projekty pro jednotlivé platformy ale typicky plní úlohu triviálního zavadìèe, který pouze pøipraví prostøedí pro bìh a následnì pøedá øízení hlavní aplikaèní logice. Podoba tìchto zavadìèù je pevnì daná a v prùbìhu vývoje aplikace se ji¾ prakticky nemìní.

Ukázalo se jako velmi výhodné vedle platformy Android pou¾ít i platformu PC a provádìt maximální mo¾né mno¾ství vývoje právì zde. Narozdíl od mobilní aplikace, kde probíhá typický proces sestavení a následné instalace do zaøízení, zde dochází k sestavení a spu¹tìní pøímo v poèítaèi vývojáøe. To probíhá øádovì v jednotkách sekund, tedy zásadnì rychleji ne¾ na mobilním zaøízení. Díky knihovna Libgdx jsou pøitom rozdíly mezi platformami z pohledu vyvíjené hry minimální a lze takto vyvíjet a celé u¾ivatelské rozhraní i ve¹keré vykreslování 3D scény. Problém nastává pøi implementace ovládání, které pro svoji funkènost vy¾aduje souèasný dotyk dvou prstù. Tuto èást bylo tedy nutné vyvíjet pøímo na skuteèném mobilním zaøízení. Díky dùmyslnému systému práce se vstupem (popsáno v kapitole \ref{sec:libgdx-vstup}) lze nahradit dotykový vstup vstupem z klávesnice. Takové øe¹ení sice není ideální (øízení letadla je skokové), ale pro vývoj èástí se vstupem pøímo nesouvisejících je více ne¾ postaèující.

Dal¹ím dùvodem k vytvoøení projektu pro platformu PC mù¾e být také tvorba propagaèních materiálù, typicky videí. V pøípadì mobilních zaøízení je snímání obrazovky a souèasné ukládání ve formì videa velmi omezené nebo úplnì nemo¾né. Je to dáno jak výkonovými mo¾nostmi, tak i potøebou speciálního oprávnìní takové snímací aplikace. U bì¾ného poèítaèe by v souèasnosti po¾adavky na výkon nemìly pøedstavovat problém a stejnì tak je snadno dostupný i software pro záznam. Opìt díky sjednocenému chování napøíè platformami je mo¾né vytvoøit video pøímo ze hry, ani¾ by neznalý divák rozeznal rozdíl. Stejnì jako pøi vývoji zde mù¾e nastat problém se vstupem. Není v¹ak slo¾ité pøi hraní na mobilním zaøízení ve¹kerý vstup zaznamenávat a následnì jej v poèítaèi pøehrávat do bì¾ící aplikace. Tímto zpùsobem lze velmi efektivnì vizualizovat i místa dotyku a vytvoøit napøíklad názornou ukázku, jak mù¾e hráè svými dotyky letadlo ovládat.

\note{TODO: jak se toèil screencast? je pou¾itý?}


\subsection{Objektová struktura aplikace}

Nyní se v popisu pøesunu od prototypu k finální aplikaci vystavené nad knihovnou Libgdx. V døívìj¹ích kapitolách ji¾ bylo zmínìno, ¾e knihovna umo¾òuje rozèlenìní aplikace do tzv. \textit{obrazovek}. Vyvíjená hra této mo¾nosti vyu¾ívá, jak je vidìt z obrázku \ref{fig:classes-main}. Do diagramu jsou zaneseny jen základní tøídy aplikace a jejich vazba na tøídy z knihovny. Ka¾dá z obrazovek má pak vazby dal¹í, které jsem v zájmu pøehlednosti oddìlil do samostatných diagramù. 

Základní tøídou aplikace je \texttt{FlightGame}, která po spu¹tìní vytváøí jednotlivé obrazovky a zaji¹»uje mechanismy pro jejich pøepínání. Souèasnì vytváøí a zpøístupòuje objekty \texttt{AssetManager} a \texttt{LevelsManager} pro naèítání obecných datových souborù a definièních souborù pro jednotlivé závody. \note{TODO: viz obrázek?}

Jak probíhá navigace mezi jednotlivými obrazovkami popisuje obrázek \note{??? - nedát ho spí¹ k UI?}. První obrazovka která se po spu¹tìní aplikace zobrazí je \texttt{LoadingScreen}. Ta obsahuje triviální animaci informující u¾ivatele o naèítání hry. Tato obrazovka musí být velmi jednoduchá, aby v dobì mezi spu¹tìním aplikace a jejím zobrazením nenabýval u¾ivatel dojmu, ¾e aplikace pøestala pracovat. Ihned po zobrazení naèítací obrazovky se volá \texttt{AssetManager}, který naète podklady pro ostatní obrazovky, vèetnì samotné hry. Tato funkcionalita je ji¾ souèástí Libgdx. V závìru naèítání je volán \texttt{LevelsManager}, který ze souborù ve formátu JSON naète definice jednotlivých závodù, aby na jejich základì mohla obrazovka hlavního menu vytvoøit navigaèní rozhraní. Pøepnutí na obrazovku samotného závodu pak v rámci jednoho spu¹tìní aplikace probíhá v¾dy témìø okam¾itì. Probìhne toti¾ pouze presunutí ji¾ naètených herních objektù na správné pozice a ¾ádným dal¹ím nároèným operacím nedochází.

\vspace{\baselineskip}
		
\note{TODO: opravit diagram - konstruktor GameScreen (a dal¹í?)}
\begin{figure}[ht]
	\begin{center}
		\includegraphics[width=\textwidth]{fig/classes-main.eps}
		\caption{Diagram klíèových tøíd aplikace}
		\label{fig:classes-main}
	\end{center}
\end{figure}

Datová reprezentace svìta je znázornìná na obrázku \ref{fig:classes-simulation}. Diagram nìkteré souvislosti v zájmu pøehledosti zjednodu¹uje, hlavní my¹lenku v¹ak zachovává. Klíèovou tøídou je zde \texttt{GameWorld}, reprezentující právì herní svìt. Z hierarchie dìdiènosti lze vyèíst, ¾e tøída roz¹iøuje tøídy \texttt{BulletWorld} a \texttt{BaseWorld}. Druhá zmínìná, tedy \texttt{BaseWorld}, pøedstavuje základní svìt obsahující vykreslitelné entity. (Samotné vykreslování v¹ak provádí tøída \texttt{GameRenderer}, spravovaná tøídou herní obrazovky.) Ka¾dá entita vzniká ze svého \textit{konstruktoru} (ve smyslu tøídy \texttt{Constructor}). Konstruktor definuje 3D model entity a v pøípadì ¾e má být entita souèástí fyzikální simulace, definuje i její kolizní tvar. Entita je pak instancí svého konstruktoru na urèitém místì ve scénì (pøesnìji øeèeno s urèitou transformací). Tento princip umo¾òuje sdílet zdrojová data v¹ech entit stejného typu a sni¾ovat tak pamì»ové i výkonové nároky.

Základní svìt \texttt{BaseWorld} tedy podporuje pouze vykreslení entit. Jeho potomek \texttt{BulletWorld} roz¹iøuje toto chování o mo¾nost provádìní fyzikální simulace. K tomu roz¹iøuje i konstruktor na \texttt{BulletConstructor}, obsahující právì informaci o kolizním tvaru a povaze tìlesa \note{viz kap. teorie ???}. Stejnì tak roz¹iøuje entitu na \texttt{BulletEntity}, se kterou mù¾e knihovna simulaci provádìt. Poslední roz¹íøení svìta je právì na nejdùle¾itìj¹í tøídu \texttt{GameWorld}, která nad bì¾ící simulací spou¹tí samotnou hru ve smyslu dodání sémantiky kolizím objektù. Z tohoto dùvodu zavádí tøídu \texttt{GateEntity}, která reprezentuje entitu, s ní¾ je kolize ¾ádoucí, tedy branku nebo kruh k prolétnutí.

Tøídy spadající pod knihovnu Bullet Physics obsahují ve svém názvu prefix \texttt{bt}. Pro pou¾ití této knihovny není nutná detailní znalost její vnitøní struktury, proto i já popí¹i tyto tøídy jen velmi zbì¾nì. Základní tøídou je \texttt{btCollisionShape}, tedy kolizní tvar objektu. Podobnì jako vytvoøením instance konstruktoru vzniká entita, tak vytvoøením instance kolizního \textit{tvaru} vzniká kolizní \textit{objekt}, který je souèástí entity a reprezentuje jej tøída \texttt{btCollisionObject}. Z hlediska výkonnosti simulace je dùle¾ité, ¾e opìt objekty vzniklé ze stejného tvaru sdílejí stejné datové struktury. Dále fyzikální svìt obsahuje instanci tøídy \texttt{btCollisionWorld}, co¾ je knihovní reprezentace prostøedí, ve kterém simulace probíhá. (Z dùvodù kompatibility rozhraní je do tøídy \texttt{BulletWorld} pouze vlo¾en a tøída z nìj pøímo nedìdí.) Toto prostøedí pøedstavuje zjednodu¹enou verzi fyzikálního svìta, kde je mo¾né pouze testovat zda dochází ke kolizi nìkterých objektù. Fyzikální simulace ve smyslu napøíklad volného pádu tìles nebo jejich vzájemná interakce zde neprobíhá. Knihovna Bullet Physics toto samozøejmì nabízí, ov¹em za cenu znaèného nárùstu po¾adavkù na výkon. Vyvíjená hra je navíc zámìrnì navr¾ena tak, aby plnohodnotná simulace probíhat nemusela.

\begin{figure}[ht!]
	\begin{center}
		\includegraphics[width=\textwidth]{fig/classes-simulation.eps}
		\caption{Diagram tøíd reprezentujících herní svìt}
		\label{fig:classes-simulation}
	\end{center}
\end{figure}



\section{Herní logika a prùbìh simulace}

Øídicí funkci z hlediska herní logiky má herní obrazovka, tedy instance tøídy \texttt{GameScreen}. Ve chvíli svého vytvoøení dostává v konstruktoru pøipravený herní svìt (tedy \texttt{GameWorld}) a v nìm naètený závod. Obrazovka vytvoøí objekt letadla (souèástí definice svìta je pouze jeho poèáteèní transformace), nastaví zpracování vstupù tak, aby se dotykové události dostaly na vstup letadla, nechá probíhat simulaci a souèasnì scénu vykresluje pomocí tøídy \texttt{GameRenderer}. 

Vykreslovací tøída je velmi jednoduchá, a proto se jí nebudu hloubìji zabývat. Z externích souborù naèítá shadery ve formátu GLSL, v ka¾dém snímku nastavuje jejich parametry a jejich pomocí vykresluje jednotlivé entity daného svìta. K tomu by jí postaèovaly instance \texttt{BaseWorld} a \texttt{BaseEntity}. Takový objekt je v¹ak ve høe pouze jediný, a sice tzv. \textit{skybox}, tedy krychle obalující celou scénu, na její¾ vnitøních stìnách je textura nebe. V¹echny ostatní objekty jsou zapojeny do fyzikální simulace, kvùli èemu¾ musejí být v hierarchii dìdiènosti ní¾e.

Z hlediska vstupù je situace taková, ¾e herní obrazovka nastaví jako jeden ze vstupních procesorù právì \texttt{PlaneInputProcessor}, který je svázán s objektem letadla. Ka¾dý vstup zpracovaný tímto procesorem se pøevede na intenzitu sil zpùsobujících rotace v jednotlivých osách. (Rotace kolem osy Y, anglicky pojmenovávaná \textit{yaw}, je pøedávána jen pro úplnost; vstup ji v¹ak pøímo ovlivòovat nemù¾e.) V okam¾iku pøíchodu události (který probíhá asynchronnì) se tedy do objektu letadla dostává informace o tom, v jaké poloze jsou které jeho ovládací prvky, nebo» právì taková je sémantika pùsobících sil. Pøi aktualizaci scény v ka¾dém snímku pak letadlo tyto síly zohledòuje pøi svém dal¹ím pohybu. Je tedy mo¾né øíct, ¾e letadlo ve scénì pohybuje autonomnì.

Herní obrazovka pøed vykreslením ka¾dého snímku vyvolá aktualizaci scény, která se skládá právì z aktualizace pozice letadla a dále z provedení kroku fyzikální simulace. Výsledkem této aktualizace mù¾e být informace o tom, ¾e nastala kolize. V takovou chvíli herní svìt rozli¹í, zda jde o kolizi ¾ádoucí (s brankou èi kruhem) nebo ne¾ádoucí (s ostatními objekty ve scénì) a nastaví pøíslu¹né pøíznaky. Obrazovka pak pouze kontroluje, zda se po provedení aktualizace zmìnil stav svìta, co¾ znamená ¾e letadlo buï prolétlo poslední brankou anebo se vybouralo. Na toto obrazovka reaguje zobrazením pøíslu¹ných dialogù.

\vspace{\baselineskip}
\note{TODO: sem dát diagram tøíd z hlediska herní logiky}

Je zde také vhodné zmínit závislost výkonu aplikace na pou¾itých kolizních tvarech, kterou jsem pøi vývoji vypozoroval. Dostateènì nízké výkonové nároky tak, aby hra bì¾ela plynule na cílených zaøízeních je nezbytností. Výkonovou nároènost hry lze sni¾ovat optimalizací vykreslování scény anebo optimalizací probíhající fyzikální simulace. Narozdíl od zpùsobu vykreslování má úprava simulace pøímý vliv na hratelnost výsledné hry. Ve høe která pou¾ívá fyzikální knihovnu pouze pro detekci kolizí není mnoho prostoru pro optimalizace. Prakticky jedinou promìnnou jsou zde kolizní tvary jednotlivých herních objektù, a právì jejich volba má dopad jak na výkon, tak i na hratelnost. Ve chvíli, kdy jsou kolizní tvary maximálnì zjednodu¹ené (koule, krychle, plochy) jsou sice po¾adavky na výkon nízké, ale kolize mù¾e být detekována (nebo naopak nedetekována) velmi nepøesnì. Dokonce natolik, ¾e si problému v¹imne i sám hráè a pøedstavuje pro nìj chybu. Pøíkladem mù¾e být aproximace kolizního tvaru kruhu pouhým ètvercem. Zde tvar nepokryje nìkteré krajní oblasti kruhu, které v¹ak hráè mù¾e cílenì vyu¾ívat pro dokonèení závodu v lep¹ím èase. Knihovna Bullet Physics podporuje kromì základních geometrických tvarù také tvary slo¾ené. Právì jejich pomocí jsem implementoval kolizní tvar kruhu, slo¾ený ze dvou ètvercù, které jsou vzájemnì pootoèené. Optimálním øe¹ením by jistì bylo pou¾ít ètvercù mnohem více, pøípadnì pak pøímo obecný polygon, v takovém pøípadì pak ale zaèínají nároky na výkon znaènì narùstat. Ji¾ pøi pou¾ití ètyø ètvercù bylo mo¾né pozorovat zpomalení hry (testováno na pøístroji Samsung Galaxy Nexus, který se v dobì psaní této práce øadí mezi zaøízení vy¹¹í tøídy). Podobnì se ukázalo vhodnìj¹í pou¾ít pro kolizní tvar letadla jednoduchý kvádr, namísto dvou kvádrù pøedstavujících trup a køídla. Oba zmiòované kolizní tvary jsou znázornìny na obrázku 

\begin{figure}[ht!]
	\begin{center}
		\includegraphics[width=\textwidth]{fig/kolizni-tvary.jpg}
		\caption{Kolizní tvary nìkterých herních objektù}
		\label{fig:kolizni-tvary}
	\end{center}
\end{figure}




\section{U¾ivatelské rozhraní}
\label{sec:implementace-ui}

\note{TODO: zmínit výsledky dotazníku týkající se UI?}
\note{TODO: vyu¾ití nativního tlaèítka zpìt}

Z hlediska u¾ivatelského rozhraní lze hru rozdìlit na dvì èásti -- hlavní menu a samotnou hru. Ty jsou implementovány v ji¾ popisovaných tøídách \texttt{MainMenu} a \texttt{GameScreen}. Vazby souèástí u¾ivatelského rozhraní jsou znázornìny na obrázku \ref{fig:ui-diagram}. Ka¾dá z obrazovek obsahuje jednu instanci potomka tøídy \texttt{BaseStage} (konkrétnì \texttt{MainMenuStage} a \texttt{GameGuiStage}), kde jsou vytváøeny jednotlivé prvky rozhraní a definováno jejich rozlo¾ení. Vyu¾ity jsou pøevá¾nì pøeddefinované komponenty, jejich¾ vizuální podoba je upravená tak, jak bylo popsáno v kapitole \ref{sec:libgdx-ui}. Kromì tìchto dvou obrazovek hra vyu¾ívá nìkolik dialogù. Ty jsou ve své výchozí podobì ztvárnìny pou¾itím plovoucího okna. Tuto podobu jsem upravil tak, ¾e dialogy okno nepou¾ívají (lépe øeèeno je vykresleno prùhlednou barvou) a namísto toho èásteènì ztmaví celou oblast obrazovky. Toto øe¹ení pùsobí ménì technicistním dojmem a lépe zapadá do vizuální podoby celé aplikace.

\vspace{\baselineskip}

\begin{figure}[ht!]
	\begin{center}
		\includegraphics[width=\textwidth]{fig/ui-diagram.eps}
		\caption{Navigace v aplikaci}
		\label{fig:ui-diagram}
	\end{center}
\end{figure}

Navigace v menu je rozdìlená do dvou úrovní. Na první úrovni lze vybírat mezi sadami závodù, na úrovni druhé pak mezi jednotlivými závody. Vizuálnì výbìr realizuje horizontálnì posuvná oblast s náhledy jednotlivých sad èi závodù. Polo¾ka nejblí¾e støedu obrazovky se pova¾uje za aktuálnì vybranou a kliknutím na její miniaturu nebo na tlaèítko \textit{PLAY} se sada èi závod vybere a spustí. Pro zøetelost vybrané polo¾ky se ostatní polo¾ky s rostoucí vzdáleností od støedu obrazovky zmen¹ují. Pøi posouvání se pak panel v¾dy zafixuje tak, aby byla aktivní polo¾ka právì ve støedu obrazovky. Pro dosa¾ení tohoto chování jsem roz¹íøil knihovní tøídu \texttt{ScrollPane}, která podporuje pouze plynulý horizontální èi vertikální posun obsahu v panelu bez dal¹ího mo¾ného nastavení nebo funkcionality. Výsledné chování implementuje tøída \texttt{MyScrollPane}. Z panelu je také odstranìn klasický posuvník, který nahrazuje skupina ikon, jejich¾ poèet je shodný s poètem polo¾ek v panelu. Ikona reprezentující aktuálnì vybranou polo¾ku je pak vizuálnì odli¹ená. Situaci ilustruje døíve uvedený obrázek \ref{fig:ui-design}, který souèasnì zachycuje rozdìlení obrazovky hlavního menu do jednotlivých komponent.

\vspace{\baselineskip}

V kapitole \ref{sec:implementace-prototypu} jsem zvolil jako optimální variantu ovládání letadla takovou, kdy nevhodné místo prvotního dotyku mù¾e omezit manévrovací schopnosti letadla. Z tohoto dùvodu a souèasnì proto, ¾e je metoda ovládání zcela nová a neznámá, jsem vytvoøil speciální dialog pro zauèení nového hráèe. Zobrazí se pøi spu¹tení prvního závodu ve høe a namísto potvrzovacích tlaèítek jsou vykresleny dva ¾luté kruhy (viz obrázek \ref{fig:ui-tutorial}). Hráè je instruován, aby se souèasnì dotkl obou kruhù, teprve poté se závod zahájí. Kruhy jsou zámìrnì zarovnány svým støedem na støed vý¹ky obrazovky s cílem nauèit hráèe tuto pozici prstù jako výchozí. Tento postup se osvìdèil. Pøi testování se ukázalo, ¾e v drtivé vìt¹inì pøípadù hráèùm staèí pro pochopení ovládání pouze informace zobrazená v tomto dialogu. Nìkteøí navrhovali, ¾e by se dialog mohl zobrazit pøed ka¾dým závodem. Jiní by preferovali, kdyby se místa optimálního dotyku zobrazovala v prùbìhu celého závodu ve chvílích, kdy se hráè obrazovky pøestane dotýkat. Pøedev¹ím druhý zmínìný námìt by mohl pomoci hráèùm rychleji se v ovládání zorientovat napøíklad v pøípadech, ¾e se ke høe vrátili po del¹í dobì. Ani jeden z tìchto námìtù v¹ak v aktuální verzi zahrnut není.


\begin{figure}[ht]
	\begin{center}
		\includegraphics[width=\textwidth]{fig/ingame-tutorial.jpg}
		\caption{Dialog pro zauèení nového hráèe}
		\label{fig:ui-tutorial}
	\end{center}
\end{figure}




\section{Vývojáøské rozhraní}

Souèástí hry je také speciální vývojáøský re¾im. Ten je pro bì¾né hráèe pøirozenì nedostupný a v publikované verzi je odstranìn. Slou¾í k jednoduchým úpravám existujících závodù a k vytváøení závodù nových. Jeho rozhraní je spí¹e strohé, av¹ak úèelné. Zachyceno je na obrázku \ref{fig:ui-dev}. Vývojáøský re¾im implementuje obrazovka \texttt{GatePlacementScreen}, u¾ivatelské rozhraní pak tøída \texttt{OverlayStage}. Obrazovka naète objekty herního svìta, podobnì jako pøi spu¹tìní závodu, s tím rozdílem, ¾e neprobíhá fyzikální simulace ani vyhodnocování stavu závodu. Scéna neobsahuje ani letadlo a kamera se mù¾e volnì pohybovat v prostoru. K tomu slou¾í tlaèítka u¾ivatelského rozhraní pro posun o pevnì danou vzdálenost, pøípadnì pak speciální vstupní procesor \texttt{FreeMoveInputProcessor} umo¾òující plynulé rozhlí¾ení a prùlet scénou. Je mo¾né pøidávat a odebírat jednotlivé kruhy a branky závodu a také nastavit poèáteèní transformaci letadla.

Z dùvodu zachování pøenositelnosti mezi platformami bohu¾el nelze závod pøímo ulo¾it a ihned jej hrát. Aktuálnì se závod vypí¹e do konzole vývojového prostøedí jako øetìzec ve formátu JSON. Ten je nutné ruènì ulo¾it do souboru v adresáøi s ostatními datovými soubory aplikace. Toto chování vzniká proto, ¾e v okam¾iku sestavování aplikace jsou ve¹keré její soubory zabaleny do jediného balíèku, který se dále zpøístupòován pouze pro ètení. Alternativnì by bylo mo¾né ukládat vytváøené závody do u¾ivatelské pamìti zaøízení, ov¹em tyto by pak byly volnì pøístupné a upravitelné, a tudí¾ by nebylo mo¾né zaruèit jejich konzistenci. Èasy jednotlivých závodù jsou vkládány také ruènì, na základì nìkolika zku¹ebních letù. V budoucnu budou èasy upravovány na základì dat získaných anonymním sbìrem statistik.

\begin{figure}[ht]
	\begin{center}
		\includegraphics[width=\textwidth]{fig/ingame-dev.jpg}
		\caption{Vývojáøské rozhraní pro tvorbu a úpravu závodù}
		\label{fig:ui-dev}
	\end{center}
\end{figure}



\section{Zveøejnìní hry a zpìtná vazba}

\subsection{Veøejné testování a prùzkum}
\label{sec:verejne-testovani}

Ve chvíli, kdy se hra dostala do finální podoby, bylo mo¾né ji zaèít veøejnì distribuovat. Souèasnì jsem pro dosud bezejmennou hru zvolil název Air Racer. Do té doby jsem testování provádìl osobními schùzkami v rùzných stádiích vývoje, kde bylo mo¾né okam¾itì reagovat na chyby a jiné nedostatky. Tento pøístup souèasnì nabízel mnohem lep¹í zpìtnou vazbu od hráèù, kterou by bylo pozdìji obtí¾né získat. Dal¹ím pøínosem bylo také pøímé testování hry na rùzných zaøízeních. Zde ¾ádné problémy nenastaly a hra bez problémù bì¾ela na v¹ech zaøízeních, se kterými deklarovala kompatibilitu.

Posledním krokem pøed zveøejnìním bylo zapojení statistik. Tuto slu¾bu poskytuje pøímo firma Google formou speciální knihovny. Pùvodnì byla navr¾ená pro sledování klasických aplikací, které jsou zalo¾eny na výchozích komponentách platformy, jako jsou Aktivity, dialogy a dal¹í. Díky poslední verzi jejího rozhraní je v¹ak mo¾né sledované události spou¹tìt manuálnì, a tím ukládat statistiky i pro hru, která má z pohledu sledující knihovny jen jedinou obrazovku. Nìkteré zajímavé statistiky mù¾e ètenáø vidìt na obrázcích \note{???} a \note{???}.

\vspace{\baselineskip}

První veøejnou verzi hry jsem vystavil na internet ve formì samostatného binárního souboru (tedy bez mo¾nosti automatické aktualizace) a nasdílel na nìkterých sociálních sítích. Souèasnì jsem vytvoøil dotazník, o jeho¾ vyplnìní jsem hráèe po¾ádal. Plné znìní dotazníku se nachází v pøíloze \note{???} této práce. Struktura dotazníku je inspirována metodou \textit{Lickert Scale} \note{citace}. Jejím cílem je nepokládat pøímé otázky, ale pøedstavovat tvrzení a mìøit, jak silnì se s nimi hodnotící ztoto¾òuje. Tím by mìlo být hodnocení jednodu¹¹í a spontánnìj¹í. Souèasnì se omezuje ne¾ádoucí kreativita hodnotícího a zjednodu¹uje se i vyhodnocení takového dotazníku. Nejèastìji se pou¾ívá stupnice o 3, 5 nebo 7 hodnotách. Dùle¾itý je v¾dy lichý poèet mo¾ností, umo¾òující hodnotícímu zaujmout neutrální postoj. Mohou nastat výjimky, kdy je ¾ádoucí pou¾ít sudý poèet mo¾ností, a tím si odpovìï vynutit. Tento pøístup ale pro vyvíjenou hru vhodný není. Dal¹í z doporuèení pøi tvorbì dotazníku metodou Lickert Scale je nezaujatost tvrzení. Ta by mìla být ideálnì pøedkládána tak, aby nebylo zøejmé, která z mo¾ností je správná. Hodnotící hráè pak mnohem ménì podléhá spoleèenským a jiným tlakùm.

\vspace{\baselineskip}

Dotazník vyplnilo 67 hráèù a z jeho výsledkù dotazníku vyplývá, ¾e první dojem z aplikace byl pozitivní, hlavní menu hráèùm pøipadá pøehledné a je dobøe ovladatelné. To potvrzuje, ¾e implementace vlastního chování posuvného panelu v menu byla úspì¹ná. Stejnì tak se osvìdèila ikona ozubeného kola reprezentující dialog s nastavením. Zajímavostí je, ¾e z hráèù odpovídajících na dotazník tento dialog otevøela asi jen ètvrtina z nich (dle údajù ze statistik). Pøesto vìt¹ina odpovìdìla, ¾e by umìla zapnout èi vypnout zvuky ve høe. Pøíèinou mù¾e být buï nedbalost pøi vyplòování dotazníku anebo fakt, ¾e jde o silnì za¾itý prvek u¾ivatelského rozhraní ve hrách, od kterého hráèi oèekávají chování, ani¾ by jej ovìøovali.

Prokázala se také vhodnost logické stavby menu. Hodnotící ve høe rozpoznali, ¾e má menu více úrovní a ¾e pro zpøístupnìní uzamèeného závodu bude pravdìpodobnì nutné splnit závod pøedchozí. V pøípadì dotazu na poèet polo¾ek závodù ve høe v¹ak byly odpovìdi sporné. To mohlo být zapøíèinìno nevhodnì formulovaným tvrzením (\textit{Mám pøedstavu o tom, kolik je ve høe levelù}), které vy¾aduje zpøístupnìní v¹ech sad závodù. Sady jsou na sebe navázány stejnì jako jednotlivé závody a do odemèení do nich nelze ani nahlédnout. Hráè který by chtìl na toto tvrzení korektnì odpovìdìt by tedy musel nejdøíve v¹echny závody zpøístupnit, co¾ v¹ak podle statistik neudìlal nikdo. Dal¹ím sporným tvrzením byla mo¾nost spu¹tìní závodu. Zde ¹lo èistì o experiment -- závod lze spustit jak tlaèítkem PLAY, tak i kliknutím na jeho náhled. Témìø tøetina odpovídajících vyu¾ila kliknutí na náhled. Pravdìpodobnì se tak chovali proto, ¾e jde opìt o chování které lze od posuvného panelu obecnì oèekávat. Statistiky vyu¾ívání tlaèítka PLAY a kliknutí na náhled závodu shrnuje obrázek \note{???}; mìøené období je pøibli¾nì jeden mìsíc.

\note{TODO: obrázek ze statstik - pomìr klikù na PLAY a na náhled}

Dal¹í èást dotazníku se vìnovala samotnému prùbìhu závodu a chování letadla. Témìø $80\%$ hráèù odpovìdìlo, ¾e jsou schopní letadlo bez pøedchozího vysvìtlení ovládat (my¹leno jiného vysvìtlení ne¾ døívì zmiòovaného dialogu pøed prvním závodem). To potvrzuje intuitivnost navrhovaného ovládání. Vìt¹ina hráèù pova¾uje ovládání za dostateènì pøesné, pøièem¾ lze s letadlem stále provádìt ostré zatáèky. Stejnì tak hráèi odpovídají, ¾e vìdí, jak pohyby jejich prstù ovlivní letadlo. Tím opìt potvrzují dobrý návrh ovládání. Souèasnì v¹ak hráèi nebyli schopni jasnì identifikovat, zda chování letadla odpovídá letu skuteèného letadla. S tím souvisí i tvrzení ohlednì pøedvídatelnosti chování letadla, kde jsou odpovìdi také vesmìs neprùkazné. Ji¾ pøi návrhu hry (v kapitole \ref{sec:zanrove-zarazeni}) jsem deklaroval, ¾e cílem hry není maximálnì vìrné napodobení letu skuteèného letadla, nýbr¾ navr¾ení chování tak, aby vyústilo v co nejvíce zábavnou a obecným hráèùm pochopitelnou hru. Z tohoto pohledu nejsou zmínìné reakce ani pozitivní ani negativní. Bylo by mo¾né øíct, ¾e se chování pohybuje na hranì s lehkým pøesahem do nerealistièna, co¾ aktuálnì pova¾uji za vhodný kompromis. Posledním tvrzením na téma ovladatelnosti byl dotaz na ovládání smìrového kormidla. Zde se hráèi rozdìlili na témìø pøesné poloviny, kdy jedna strana preferuje ovládání pøímé a druhá inverzní. Tento jev se projevil je¹tì pøed veøejným testování a hra ji¾ v dobì vyplòování dotazníku obsahovala mo¾nost pøevrácení svislé ovládací osy. Tato volba je u leteckých her velmi èasto pou¾ívaná a mìla by uspokojit obì skupiny hráèù. Výchozí chování je nastaveno na inverzní, kde posun prstù ke spodní hranì obrazovky zvedá letadlo nahoru. Toto chování toti¾ více odpovídá chování kniplu ve skuteèném letadle (pøípadnì hernímu joysticku).

Poslední èást dotazníku se vìnovala skladbì závodù a prostøedí ve kterém se odehrávají. Letadlo podle vìt¹iny hráèù letí spí¹e pomalu, stejnì jako obtí¾nost závodù hodnotí spí¹e jako nízkou. Je v¹ak vhodné dodat, ¾e statistiky v období vyplòování dotazníku ukazovaly, ¾e do pokroèilej¹ích závodù postoupilo jen malé mno¾ství hráèù. Toto tvrzení tak hodnotí spí¹e subjektivní obtí¾nost, která v¹ak mù¾e být zajímavým doplòkem objektivní obtí¾nosti, kterou lze získat ze statistik na základì èetnosti úspì¹ných dokonèení jednotlivých závodù. \note{Viz obrázek s èetnostma?} Drtivé vìt¹inì odpovídajících hráèù se pak podaøilo dokonèit alespoò jeden závod a alespoò jednou dokonèit závod se ziskem tøí hvìzdièek. Hráèi kladnì ohodnotili také navigaèní ¹ipku, která ukazuje smìr k následujícímu kruhu èi brance. Z dodateèných odpovìdí (volitelný vzkaz na konci dotazníku) vyplývá, ¾e by ocenili i informaci o vzdálenosti následujícího cíle, pøípadnì náhled na rozlo¾ení branek v celém závodì. V závìru bylo pøedstaveno nìkolik tvrzení ohlednì scenerie závodu. Z odpovìdí lze vyèíst, ¾e hráèi prostøedí spí¹e nevnímají, souèasnì by v¹ak uvítali kdyby hra obsahovala více dekorativních objektù. Tyto reakce lze pøièíst subjektivní prázdnotì prostøedí závodu. Pøi vývoji se ukázalo jako velmi efektivní nechat závod probíhat nad moøem v teoreticky neomezeném prostoru. Hráèi ale zøejmì vnímají jistý nedostatek ukotvení scenerie. Vhodným øe¹ením by mohlo být omezení herního prostoru tak, ¾e by závod probíhal napøíklad podél skalního útesu nebo mìsta. Vzhledem k tématice by pak bylo mo¾né doplnit divácké tribuny, reklamní plochy a dal¹í objekty. To mù¾e být tématem dal¹ího roz¹iøování hry.

\vspace{\baselineskip}

V rámci udr¾ení hráèù jsem do veøejnì testované verze zabudoval omezení, které hru dovolí hrát pouze dva týdny. Poté bude po spu¹tìní nabízet pouze mo¾nost pøechodu do obchodu Google Play, kde bude mo¾né stáhnout finální verzi hry. 




\subsection{Zveøejnìní na Google Play}

\note{TODO: pøed tiskem aktualizovat hodnoty}

Verze publikovaná na internetovém obchodì Google Play se od veøejnì testované prakticky neli¹í. Opravil jsem nìkolik drobných nedostatkù, které se projevovaly pouze na úzkém okruhu zaøízení a samozøejmì jsem také odstranil èasové omezení. V souvislosti s publikováním bylo nutné vytvoøit nìkolik variant propagaèních materiálù. Jeliko¾ jsem ve¹keré grafické podklady vytváøel já sám, mù¾e být jejich kvalita sporná. Zpìtnì bych pravdìpodobnì zvá¾il spolupráci s profesionálním grafikem. Pøesto se volba jednoduché ikony s vyobrazeným letadlem ukázala jako vhodná. Obecný vliv prezentaèních materiálù na potenciální u¾ivatele v¹ak nelze nijak mìøit.

Pro publikování v obchodì je nutné vlastnit vývojáøský úèet, jeho¾ vytvoøení je v dobì psaní této práce podmínìno poplatkem \$25. Vytvoøení úètu, stejnì jako publikování aplikace pak probíhá na poèkání. Není tedy nutné poèítat se zpo¾dìním pøi vydávání aplikace tak, jak je tomu u jiných platforem. Publikovaná aplikace musí být podepsaná soukromým klíèem vývojáøe a stejným klíèem pak musí být podepsány v¹echny dal¹í aktualizace. V pøípadì ztráty tohoto klíèe ji¾ nelze binární podobu aplikace nahrané v obchodì nijak upravovat. 

\vspace{\baselineskip}

Po vydání aplikace jsem ji opìt propagoval na sociálních sítích, vèetnì nìkolika komunit specializovaných na hry a platformu Android. Souèasnì jsem ¾ádal hráèe, aby hru v obchodì ohodnotili (dle vlastní vùle), èím¾ ji uèiní teoreticky lákavìj¹í pro dal¹í potenciální hráèe. Hodnocení probíhá udìlením jedné a¾ pìti hvìzdièek a pøidání pøípadného komentáøe. Poèet hodnotících hráèù je v¹ak velmi nízký, dle souèasných statistik vlo¾í hodnocení ménì ne¾ jeden hráè z 500, komentáø pak vlo¾í asi jeden z tisíce. Aktuálnì hru hodnotilo 87 hráèù, pøièem¾ 61 zvolilo nejvy¹¹í hodnocení, 13 pak hodnocení nejni¾¹í. Pøi takto nízkém poètu v¹ak nemá hodnocení ani vìt¹ina komentáøù témìø ¾ádnou vypovídací hodnotu. Hodnocení hráèù jsem se sna¾il podpoøit herním dialogem, který se jednorázovì spustí po splnìní v¹ech závodù z první sady. 

I pøes nízkou úèast hráèù v hodnocení se hra v obchodì prosadila a necelý mìsíc po vydání se dostala na pozici deváté nejlep¹í závodní hry. Graf vývoje pozice v jednotlivých dnech je na obrázku \ref{fig:pozice-play}. Celkový poèet instalací pøesahuje 47000, pøièem¾ denní trend nových u¾ivatelù v souèasnosti spí¹e stagnuje. 

\begin{figure}[ht]
	\begin{center}
		\includegraphics[width=\textwidth]{fig/pozice-play.pdf}
		\caption{Vývoj pozice hry v Google Play, v kategorii závodních her}
		\label{fig:pozice-play}
	\end{center}
\end{figure}




\section{Mo¾nosti dal¹ího vývoje}
\note{- shrnout slabiny, rozepsat co by se dalo dál roz¹iøovat, co má smysl a co spí¹ ne}
\note{- hra má velký potenciál -> monetizace}
\note{- zdaleka se nevyèerpal popsaný návrh hry - stále co dìlat}
\note{- pøidání tøetí osy ovládání - smìrovka - zmiòuje ji texto o prototypu }


\chapter{Závìr}

\note{TODO: revize}

Tento text shrnul mo¾nosti vývoje 3D her na platformì Android, jeho pøínosy a nedostatky. Dále se vìnoval popisu letu skuteèného letadla a z~nìho vycházející zjednodu¹ené simulaci letu pou¾ívané v~hrách. Srovnává také existující metody ovládání leteckých her a navrhuje novou metodu, která záva¾nými nedostatky oproti ostatním netrpí. Navrhovaná metoda je zalo¾ená na dotykovém vstupu za pou¾ití dvou prstù a nabízí velmi rychlé a pøesné ovládání, èím¾ posiluje dojem ¾e má hráè letadlo plnì pod kontrolou.

Dále tato práce popsala návrh a prvotní implementaci hry, která toto ovládání vyu¾ívá. Jde o~hru kde hráè s~akrobatickým letadlem prolétává brankami a sna¾í se doletìt do cíle v~co nejkrat¹ím èase. Hra je navr¾ená tak, aby co nejvíce tì¾ila z~navr¾ené ovládací metody, podpoøila tak její platnost a v~ideálním pøípadì i její dal¹í roz¹íøení na poli leteckých her. V~prùbìhu vývoje vznikl prototyp hry, na kterém se ovìøily základní my¹lenky a principy ovládání. Na nìkolika testovacích subjektech se potvrdila jeho pou¾itelnost a v~souèasnosti probíhá vývoj dal¹í verze hry, tentokrát vystavené na knihovnì Libgdx. Ta by mìla implementovat popsané herní mechanismy a následnì se rozvinout v~plnohodnotnou hru. Detailní popis implementace v~této práci chybí, nebo» ta je¹tì není zcela ustálená a s~velkou pravdìpodobností se bude dále vyvíjet. Souèasnì je v~plánu pøed vydáním hry provést nejménì jedno rozsáhlej¹í a øádnì zdokumentované u¾ivatelské testování.









